[
  {
    "articleStyle": 3,
    "cacheFirst": false,
    "customOrder": -10098481,
    "enableJs": true,
    "enabled": true,
    "enabledCookieJar": true,
    "header": "@js:\nJSON.stringify({\n    \"User-Agent\":java.getWebViewUA(),\n    \"Referer\":\"https://api.huaban.com/\"\n})",
    "lastUpdateTime": 1768478974348,
    "loadWithBaseUrl": true,
    "loginUi": "[\n  {\n    name: \"äº®è‰²ä¸»é¢˜\",\n    type: \"button\",\n    action: \"liang()\",\n    style: {\n    \tlayout_flexGrow: 1, \n    \tlayout_flexBasisPercent: 0.45\n    \t}\n  },\n  {\n    name: \"æš—è‰²ä¸»é¢˜\",\n    type: \"button\",\n    action: \"an()\",\n    style: {\n    \tlayout_flexGrow: 1, \n    \tlayout_flexBasisPercent: 0.45\n    \t}\n  }\n]",
    "loginUrl": "function liang() {\n  let config = {}\n  config.background = \"floralwhite\"\n  config.color = \"black\"\n  cache.put(\"hb_theme\", JSON.stringify(config))\n  java.toast(\"äº®è‰²ä¸»é¢˜\")\n}\nfunction an() {\n  let config = {}\n  config.background = \"#151924\"\n  config.color = \"floralwhite\"\n  cache.put(\"hb_theme\", JSON.stringify(config))\n  java.toast(\"æš—è‰²ä¸»é¢˜\")\n}\nfunction login() {}",
    "preload": false,
    "ruleArticles": "$.pins",
    "ruleContent": "$.pin.file.key&&$.pin.board.pins[*].file.key\n<js>\n  li='\\n'\n  list=result.split('\\n')\n  for(i in list){\n  li += '<li><img data-src=\"http://hbimg.huaban.com/'+list[i]+'\" referrerpolicy=\"origin\" alt=\"å›¾ç‰‡\"></li>\\n'\n  }\n  li\n</js>\n\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui\">\n  <title>{{$.pin.board.title}} - å›¾ç‰‡é›†</title>\n  <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.css\">\n  <style>\n  :root {\n    --item-width: 97vw;\n    --aspect-ratio: 3/4;\n    --bg-color: {{cache.get(\"hb_theme\") == null ? \"floralwhite\" : JSON.parse(cache.get(\"hb_theme\")).background}};\n    --text-color: {{cache.get(\"hb_theme\") == null ? \"black\" : JSON.parse(cache.get(\"hb_theme\")).color}};\n  }\n\n  body {\n    margin: 0;\n    padding: 20px 0;\n    background-color: var(--bg-color);\n    color: var(--text-color);\n    font-family: system-ui, -apple-system, sans-serif; /* ä¼˜åŒ–å­—ä½“ä¼˜å…ˆçº§ */\n    min-height: 100vh;\n  }\n\n  h1{\n    text-align:center;\n    font-size:20px;\n    line-height:1.5em;\n    margin: 0 0 16px; /* è¡¥å……åˆç†å¤–è¾¹è· */\n  }\n\t\n  p{  }\n\t\n  p{\n    text-indent:2em;\n    padding:0 20px;\n    overflow-wrap: break-word;\n    word-break: break-all;\n    margin: 8px 0; /* ç»Ÿä¸€æ®µè½é—´è· */\n  }\n  \n  .gallery {\n    list-style: none;\n    padding: 0;\n    margin: 20px auto; /* å¢åŠ ä¸Šä¸‹å¤–è¾¹è·ï¼Œé¿å…ç´§è´´æ–‡æœ¬ */\n    width: calc(var(--item-width) - 30px);\n    max-width: 400px;\n  }\n\n  .gallery li {\n    width: 100%;\n    margin-bottom: 15px;\n    background: var(--bg-color);\n    border-radius: 8px;\n    overflow: hidden;\n    position: relative;\n    height: 0;\n    padding-top: calc(100% / (var(--aspect-ratio, 3/4)));\n    box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n  }\n\n  .gallery img {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n    opacity: 0;\n    transition: opacity 0.4s ease-out;\n  }\n\n  .gallery img[loaded] {\n    opacity: 1;\n  }\n\n  .gallery img.error {\n    filter: grayscale(1);\n    background: repeating-linear-gradient( \n      45deg,\n      #f1f3f5,\n      #f1f3f5 10px,\n      #e9ecef 10px,\n      #e9ecef 20px\n    );\n  }\n\n  .gallery li.error::after {\n    content: \"åŠ è½½å¤±è´¥\";\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    color: #ff6b6b;\n    font-size: 14px;\n    display: block;\n    z-index: 1;\n  }\n  </style>\n</head>\n<body>\n  <h1>{{$.pin.board.title}}</h1>\n  <p>Byï¼š{{$.pin.user.username}}</p>\n  <p>{{$.pin.raw_text}}</p>\n  <p>{{$.pin.board.description}}</p>\n  <ul class=\"gallery\">\n    {{result}}\n  </ul>\n\n  <script src=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.js\"></script>\n  <script>\n    const CONFIG = {\n      retry: {\n        maxAttempts: 3,\n        initialDelay: 1000,\n        backoff: 2\n      },\n      viewer: {\n        toolbar: {\n          zoomIn: 1,\n          zoomOut: 1,\n          oneToOne: 1,\n          reset: 1\n        },\n        transition: false,\n        navbar: false,\n        title: false\n      }\n    };\n\n    const viewerManager = {\n      instance: null,\n      isLoading: false,\n      async init() {\n        if (this.isLoading) return;\n        this.isLoading = true;\n        this.destroy();\n        this.instance = new Viewer(document.querySelector('.gallery'), {\n          ...CONFIG.viewer,\n          url: 'data-src',\n          hidden: () => this.onViewerClose(),\n          ready: () => {\n            this.isLoading = false;\n            this.bindClickFallback();\n          }\n        });\n      },\n      onViewerClose() {\n        this.instance?.hide();\n      },\n      destroy() {\n        if (this.instance) {\n          try {\n            this.instance.destroy();\n            document.querySelectorAll('.viewer-container').forEach(container => container.remove());\n          } catch (e) {\n            console.error('Vieweré”€æ¯å¤±è´¥:', e);\n          }\n          this.instance = null;\n        }\n      },\n      bindClickFallback() {\n        document.querySelector('.gallery').addEventListener('click', (e) => {\n          const target = e.target.closest('img[loaded]');\n          if (target && this.instance) {\n            const index = Array.from(document.querySelectorAll('.gallery img')).indexOf(target);\n            this.instance.view(index);\n          }\n        });\n      }\n    };\n\n    const imageLoader = {\n      loadAllImages() {\n        document.querySelectorAll('.gallery img').forEach(img => {\n          // åˆå§‹åŒ–æ—¶å¼ºåˆ¶æ·»åŠ  referrerpolicy å±æ€§\n          img.setAttribute('referrerpolicy', 'origin');\n          this.loadImage(img);\n        });\n      },\n      loadImage(img) {\n        if (img.src) return;\n        const src = `${img.dataset.src}?t=${Date.now()}`;\n        const tempImg = new Image();\n        // ä¸´æ—¶å›¾ç‰‡ä¹Ÿæ·»åŠ  referrerpolicyï¼Œé¿å…è¯·æ±‚æ³„æ¼ referrer\n        tempImg.referrerPolicy = 'origin';\n\n        tempImg.onload = () => {\n          const aspectRatio = tempImg.naturalWidth / tempImg.naturalHeight;\n          img.parentElement.style.setProperty('--aspect-ratio', aspectRatio);\n          img.src = src;\n          img.setAttribute('loaded', '');\n          this.scheduleViewerUpdate();\n        };\n\n        tempImg.onerror = () => this.handleError(img);\n        tempImg.src = src;\n      },\n      handleError(img, attempt = 1) {\n        if (attempt > CONFIG.retry.maxAttempts) {\n          img.classList.add('error');\n          img.parentElement.classList.add('error');\n          img.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPgogIDxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9IiNlZWVlZWUiLz4KICA8dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxMiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iIzk5OSI+CiAgICBsb2FkIGZhaWxlZAogIDwvdGV4dD4KPC9zdmc+';\n          img.alt = 'å›¾ç‰‡åŠ è½½å¤±è´¥';\n          return;\n        }\n        setTimeout(() => {\n          this.loadImage(img);\n        }, CONFIG.retry.initialDelay * Math.pow(CONFIG.retry.backoff, attempt - 1));\n      },\n      scheduleViewerUpdate() {\n        requestAnimationFrame(() => {\n          viewerManager.instance?.update();\n        });\n      }\n    };\n   \n    document.addEventListener('DOMContentLoaded', () => {\n      viewerManager.init();\n      imageLoader.loadAllImages();\n    });\n\n    const parentUl = document.querySelector('ul'); \n    const li2 = document.querySelectorAll('li')[1]; \n    const p = document.createElement('p');\n    p.textContent = 'ç›¸å…³æ¨èï¼š';\n    parentUl.insertBefore(p, li2);\n\n    window.addEventListener('resize', () => {\n      viewerManager.instance?.update();\n    });\n\n    window.addEventListener('beforeunload', () => {\n      viewerManager.destroy();\n    });\n  </script>\n</body>\n</html>\n",
    "ruleImage": "https://hbimg.huaban.com/{{$.file.key}}##$##,{\n\t\"headers\":{\"referer\": \"https://api.huaban.com/\"}\n}",
    "ruleLink": "https://api.huaban.com/pins/{{$.pin_id}}",
    "ruleNextPage": "@js:\nif (!/search/.test(baseUrl)) {\n    baseUrl.replace(/\\?max=\\d+&limit=20|\\?limit=20/g, '?max={{$.pins[-1].pin_id}}&limit=20');\n}\nelse baseUrl;",
    "rulePubDate": "{{java.timeFormatUTC(java.getString(\"created_at\")*1000,\"YYYY-MM-dd HH:mm:ss\",8)}}",
    "ruleTitle": "{{$.raw_text}}â¤ï¸{{$.board.like_count}}",
    "searchUrl": "/search/?sort=all&q={{key}}&page={{page}}&per_page=20",
    "showWebLog": false,
    "singleUrl": false,
    "sortUrl": "æœç´¢::/search/?sort=all&q={{source.getVariable()=='' ? 'ç¾å¥³':source.getVariable()}}&page={{page}}&per_page=20\næœ€æ–°::/all/?limit=20\nç¾å›¾::/all/quotes?limit=20\næ˜æ˜Ÿ::/all/people?limit=20\nç¾å¥³::/all/beauty?limit=20\næ‘„å½±::/all/photography?limit=20\næ’ç”»::/all/illustration?limit=20\næ¸¸æˆ::/all/games?limit=20\nåŠ¨æ¼«::/all/anime?limit=20\nå»ºç­‘::/all/architecture?limit=20\nå·¥ä¸š::/all/industrial_design?limit=20\næå®¢::/all/geek?limit=20\næ•°æ®å›¾::/all/data_presentation?limit=20\næ±½è½¦::/all/cars_motorcycles?limit=20\nç”µå½±::/all/film_music_books?limit=20\näººæ–‡::/all/art?limit=20\nå®¶å±…::/all/home?limit=20\nå¥³è£…::/all/apparel?limit=20\nç”·å£«::/all/men?limit=20\nç¾å¦†::/all/modeling_hair?limit=20\næ‰‹å·¥::/all/diy_crafts?limit=20\nç¾é£Ÿ::/all/food_drink?limit=20\næ—…è¡Œ::/all/travel_places?limit=20\nå©šç¤¼::/all/wedding_events?limit=20\nå„¿ç«¥::/all/kids?limit=20\nå® ç‰©::/all/pets?limit=20\nç¤¼ç‰©::/all/desire?limit=20\nUI/UX::/all/web_app_icon?limit=20\nå¹³é¢::/all/design?limit=20\nç”Ÿæ´»::/all/tips?limit=20\næ•™è‚²::/all/education?limit=20\nè¿åŠ¨::/all/sports?limit=20\næç¬‘::/all/funny?limit=20",
    "sourceComment": "By å¹³é™",
    "sourceGroup": "å›¾ç‰‡",
    "sourceIcon": "https://calmss.netlify.app/img/huaban.png",
    "sourceName": "èŠ±ç“£",
    "sourceUrl": "https://api.huaban.com/##å¹³é™",
    "type": 0,
    "variableComment": "æœç´¢å…³é”®å­—"
  },
  {
    "articleStyle": 2,
    "cacheFirst": false,
    "customOrder": 78,
    "enableJs": true,
    "enabled": true,
    "enabledCookieJar": true,
    "header": "{\"Referer\":\"https://wss03.top/\"}",
    "jsLib": "function getImgTag(link) {\n    if (typeof link !== 'string' || link.trim() === '') {\n        return '';\n    }\n\n    const list = link.split('\\n')\n        .map(item => item.trim())\n        .filter(item => item !== '');\n\n    if (list.length === 0) {\n        return '';\n    }\n\n    const imgTags = list.reduce((acc, url) => {\n        if (url.startsWith('http://') || url.startsWith('https://')) {\n            acc.push(`<li><img data-src=\"${url}\" alt=\"å›¾ç‰‡\"></li>`);\n        }\n        return acc;\n    }, []);\n\n    return '\\n' + imgTags.join('\\n') + '\\n';\n}\n\nfunction getHtml(imgTag) {\n    return `<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n    <title>å›¾ç‰‡</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.css\">\n    <style>\n        :root {\n            --item-width: 97vw;\n            --aspect-ratio: 65/100;\n        }\n\n        body {\n            margin: 0;\n            padding: 20px 0;\n            background-color: floralwhite;\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n            min-height: 100vh;\n        }\n\n        .gallery {\n            list-style: none;\n            padding: 0;\n            margin: 0 auto;\n            width: calc(var(--item-width) - 30px);\n            max-width: 400px;\n        }\n\n            .gallery li {\n                width: 100%;\n                margin-bottom: 15px;\n                background: floralwhite;\n                border-radius: 8px;\n                overflow: hidden;\n                position: relative;\n                height: 0;\n                padding-top: calc(100% / (var(--aspect-ratio, 3/4)));\n                box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n                /* é¢„åŠ è½½å ä½ï¼Œå‡å°‘é—ªçƒ */\n                background: #f8f9fa;\n            }\n\n                .gallery li.error {\n                    background: repeating-linear-gradient( 45deg, #f1f3f5, #f1f3f5 10px, #e9ecef 10px, #e9ecef 20px );\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    color: #ff6b6b;\n                    font-size: 14px;\n                }\n\n                    .gallery li.error::after {\n                        content: \"åŠ è½½å¤±è´¥\";\n                    }\n\n            .gallery img {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                object-fit: cover;\n                opacity: 0;\n                transition: opacity 0.4s ease-out;\n                /* æå‡å›¾ç‰‡æ¸²æŸ“æ€§èƒ½ */\n                will-change: opacity;\n            }\n\n                .gallery img[loaded] {\n                    opacity: 1;\n                }\n    </style>\n</head>\n<body>\n    <ul class=\"gallery\">\n        ${imgTag}\n    </ul>\n\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.js\"></script>\n    <script>\n        const CONFIG = {\n            retry: {\n                maxAttempts: 3,\n                initialDelay: 1000,\n                backoff: 2\n            },\n            viewer: {\n                toolbar: {\n                    zoomIn: 1,\n                    zoomOut: 1,\n                    oneToOne: 1,\n                    reset: 1\n                },\n                transition: false,\n                navbar: false,\n                title: false\n            },\n            // å¹¶å‘æ§åˆ¶é…ç½®\n            load: {\n                concurrency: 3, // åŒæ—¶åŠ è½½çš„å›¾ç‰‡æ•°é‡\n                batchDelay: 300 // æ‰¹æ¬¡åŠ è½½å»¶è¿Ÿï¼ˆmsï¼‰\n            }\n        };\n\n        // Viewerå®ä¾‹ç®¡ç† - ä¼˜åŒ–æ›´æ–°é¢‘ç‡\n        const viewerManager = {\n            instance: null,\n            updateTimer: null,\n            init() {\n                if (this.instance) return;\n                this.instance = new Viewer(document.querySelector('.gallery'), {\n                    ...CONFIG.viewer,\n                    url: 'data-src'\n                });\n            },\n            // é˜²æŠ–æ›´æ–°ï¼Œå‡å°‘DOMæ“ä½œ\n            update() {\n                if (this.updateTimer) clearTimeout(this.updateTimer);\n                this.updateTimer = setTimeout(() => {\n                    this.instance?.update();\n                    this.updateTimer = null;\n                }, 100);\n            },\n            destroy() {\n                if (this.instance) {\n                    try {\n                        this.instance.destroy();\n                        document.querySelectorAll('.viewer-container').forEach(container => container.remove());\n                    } catch (e) {\n                        console.error('Vieweré”€æ¯å¤±è´¥:', e);\n                    }\n                    this.instance = null;\n                }\n            }\n        };\n\n        // å›¾ç‰‡åŠ è½½æ§åˆ¶ - æ ¸å¿ƒä¼˜åŒ–\n        const imageLoader = {\n            loadingCount: 0, // å½“å‰åŠ è½½ä¸­çš„å›¾ç‰‡æ•°\n            imageQueue: [],  // å¾…åŠ è½½å›¾ç‰‡é˜Ÿåˆ—\n\n            // åˆå§‹åŒ–åŠ è½½é˜Ÿåˆ—\n            initQueue() {\n                this.imageQueue = Array.from(document.querySelectorAll('.gallery img'));\n                // å¯åŠ¨å¹¶å‘åŠ è½½\n                this.loadNextBatch();\n            },\n\n            // åŠ è½½ä¸‹ä¸€æ‰¹å›¾ç‰‡\n            loadNextBatch() {\n                // è¿˜æœ‰å¾…åŠ è½½å›¾ç‰‡ && å½“å‰åŠ è½½æ•° < æœ€å¤§å¹¶å‘æ•°\n                while (this.imageQueue.length > 0 && this.loadingCount < CONFIG.load.concurrency) {\n                    const img = this.imageQueue.shift();\n                    this.loadImage(img);\n                }\n            },\n\n            // å•å¼ å›¾ç‰‡åŠ è½½é€»è¾‘\n            loadImage(img, attempt = 1) {\n                // é˜²æ­¢é‡å¤åŠ è½½\n                if (img.hasAttribute('loading') || img.src || img.parentElement.classList.contains('error')) {\n                    this.loadingCount--;\n                    this.loadNextBatch();\n                    return;\n                }\n\n                img.setAttribute('loading', '');\n                this.loadingCount++;\n\n                // ç§»é™¤æ—¶é—´æˆ³ï¼Œåˆ©ç”¨æµè§ˆå™¨ç¼“å­˜\n                const src = img.dataset.src;\n                const tempImg = new Image();\n\n                tempImg.onload = () => {\n                    // æå‰è®¡ç®—å®½é«˜æ¯”ï¼Œå‡å°‘å¸ƒå±€é—ªçƒ\n                    const aspectRatio = tempImg.naturalWidth / tempImg.naturalHeight;\n                    if (aspectRatio > 1) {\n                        img.parentElement.style.setProperty('--aspect-ratio', 4/3);\n                    }\n\n                    img.src = src;\n                    img.setAttribute('loaded', '');\n                    img.removeAttribute('loading');\n\n                    this.loadingCount--;\n                    this.scheduleViewerUpdate();\n\n                    // å»¶è¿ŸåŠ è½½ä¸‹ä¸€æ‰¹ï¼Œé¿å…ç¬é—´è¯·æ±‚\n                    setTimeout(() => {\n                        this.loadNextBatch();\n                    }, CONFIG.load.batchDelay);\n                };\n\n                tempImg.onerror = () => {\n                    img.removeAttribute('loading');\n                    this.handleError(img, attempt);\n                };\n\n                // ä¼˜åŒ–ï¼šæ·»åŠ è¶…æ—¶å¤„ç†\n                tempImg.timeoutId = setTimeout(() => {\n                    tempImg.onerror();\n                }, 10000); // 10ç§’è¶…æ—¶\n\n                tempImg.src = src;\n            },\n\n            // é”™è¯¯å¤„ç†ï¼ˆä¿®å¤é‡è¯•è®¡æ•°ï¼‰\n            handleError(img, attempt) {\n                this.loadingCount--;\n\n                // é‡è¯•æ¬¡æ•°æœªè¾¾ä¸Šé™\n                if (attempt < CONFIG.retry.maxAttempts) {\n                    const delay = CONFIG.retry.initialDelay * Math.pow(CONFIG.retry.backoff, attempt - 1);\n                    setTimeout(() => {\n                        // é‡æ–°åŠ å…¥é˜Ÿåˆ—æœ«å°¾\n                        this.imageQueue.push(img);\n                        this.loadNextBatch();\n                    }, delay);\n                } else {\n                    // é‡è¯•å¤±è´¥\n                    img.parentElement.classList.add('error');\n                    img.alt = 'å›¾ç‰‡åŠ è½½å¤±è´¥';\n                    this.scheduleViewerUpdate();\n                    // åŠ è½½ä¸‹ä¸€å¼ \n                    this.loadNextBatch();\n                }\n            },\n\n            scheduleViewerUpdate() {\n                viewerManager.update();\n            }\n        };\n\n        // é¡µé¢åˆå§‹åŒ–\n        document.addEventListener('DOMContentLoaded', () => {\n            viewerManager.init();\n            imageLoader.initQueue();\n        });\n\n        // çª—å£å˜åŒ–æ—¶é˜²æŠ–æ›´æ–°\n        window.addEventListener('resize', () => {\n            viewerManager.update();\n        });\n\n        // é¡µé¢å¸è½½æ—¶é”€æ¯\n        window.addEventListener('beforeunload', () => {\n            viewerManager.destroy();\n        });\n    </script>\n</body>\n</html>`;\n}",
    "lastUpdateTime": 1768392593536,
    "loadWithBaseUrl": true,
    "preload": false,
    "ruleArticles": "class.listpic",
    "ruleContent": "class.nbodys@img@src\n<js>\nresult = getHtml(getImgTag(result));\n</js>",
    "ruleImage": "class.vodpic@data-original",
    "ruleLink": "tag.a.0@href##$##,{'webView': true}",
    "ruleNextPage": "class.page@tag.li.-2@a@href##$##,{'webView': true}",
    "rulePubDate": "class.time@text",
    "ruleTitle": "class.vodname@text",
    "showWebLog": false,
    "singleUrl": false,
    "sortUrl": "ç²¾å“å›¾é›†::/pic/list.html?cate_id=1079##$##,{'webView': true}\næ¬§ç¾é£æƒ…::/pic/list.html?cate_id=1080##$##,{'webView': true}\näºšæ´²æƒ…è‰²::/pic/list.html?cate_id=1081##$##,{'webView': true}\næ€§çˆ±è‡ªæ‹::/pic/list.html?cate_id=1082##$##,{'webView': true}\næˆäººåŠ¨æ¼«::/pic/list.html?cate_id=1083##$##,{'webView': true}\nç¾è…¿ä¸è¢œ::/pic/list.html?cate_id=1084##$##,{'webView': true}\nå”¯ç¾å†™çœŸ::/pic/list.html?cate_id=1085##$##,{'webView': true}\näººä½“è‰ºæœ¯::/pic/list.html?cate_id=1086##$##,{'webView': true}",
    "sourceComment": "æœ‰äº›IPæ— æ³•æ˜¾ç¤ºï¼Œå…³é—­VPNå³å¯å±•ç¤º\nmdd60.com\nhttps://wsrtukht.top/guide.html\nwss41.com",
    "sourceGroup": "å›¾ç‰‡",
    "sourceIcon": "https://i.postimg.cc/ZRXvkz27/gF2H6e.gif",
    "sourceName": "ğŸ“–éº»è±†Â®",
    "sourceUrl": "https://wxmxfsixi.top:2549",
    "type": 0
  },
  {
    "articleStyle": 3,
    "cacheFirst": false,
    "customOrder": 81,
    "enableJs": true,
    "enabled": true,
    "enabledCookieJar": false,
    "jsLib": "function getImgTag(link) {\n    if (typeof link !== 'string' || link.trim() === '') {\n        return '';\n    }\n\n    const list = link.split('\\n')\n        .map(item => item.trim())\n        .filter(item => item !== '');\n\n    if (list.length === 0) {\n        return '';\n    }\n\n    const imgTags = list.reduce((acc, url) => {\n        if (url.startsWith('http://') || url.startsWith('https://')) {\n            acc.push(`<li><img data-src=\"${url}\" alt=\"å›¾ç‰‡\"></li>`);\n        }\n        return acc;\n    }, []);\n\n    return '\\n' + imgTags.join('\\n') + '\\n';\n}\n\nfunction getHtml(imgTag) {\n    return `<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n    <title>å›¾ç‰‡</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.css\">\n    <style>\n        :root {\n            --item-width: 97vw;\n            --aspect-ratio: 65/100;\n        }\n\n        body {\n            margin: 0;\n            padding: 20px 0;\n            background-color: floralwhite;\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n            min-height: 100vh;\n        }\n\n        .gallery {\n            list-style: none;\n            padding: 0;\n            margin: 0 auto;\n            width: calc(var(--item-width) - 30px);\n            max-width: 400px;\n        }\n\n            .gallery li {\n                width: 100%;\n                margin-bottom: 15px;\n                background: floralwhite;\n                border-radius: 8px;\n                overflow: hidden;\n                position: relative;\n                height: 0;\n                padding-top: calc(100% / (var(--aspect-ratio, 3/4)));\n                box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n                /* é¢„åŠ è½½å ä½ï¼Œå‡å°‘é—ªçƒ */\n                background: #f8f9fa;\n            }\n\n                .gallery li.error {\n                    background: repeating-linear-gradient( 45deg, #f1f3f5, #f1f3f5 10px, #e9ecef 10px, #e9ecef 20px );\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    color: #ff6b6b;\n                    font-size: 14px;\n                }\n\n                    .gallery li.error::after {\n                        content: \"åŠ è½½å¤±è´¥\";\n                    }\n\n            .gallery img {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                object-fit: cover;\n                opacity: 0;\n                transition: opacity 0.4s ease-out;\n                /* æå‡å›¾ç‰‡æ¸²æŸ“æ€§èƒ½ */\n                will-change: opacity;\n            }\n\n                .gallery img[loaded] {\n                    opacity: 1;\n                }\n    </style>\n</head>\n<body>\n    <ul class=\"gallery\">\n        ${imgTag}\n    </ul>\n\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.js\"></script>\n    <script>\n        const CONFIG = {\n            retry: {\n                maxAttempts: 3,\n                initialDelay: 1000,\n                backoff: 2\n            },\n            viewer: {\n                toolbar: {\n                    zoomIn: 1,\n                    zoomOut: 1,\n                    oneToOne: 1,\n                    reset: 1\n                },\n                transition: false,\n                navbar: false,\n                title: false\n            },\n            // å¹¶å‘æ§åˆ¶é…ç½®\n            load: {\n                concurrency: 3, // åŒæ—¶åŠ è½½çš„å›¾ç‰‡æ•°é‡\n                batchDelay: 300 // æ‰¹æ¬¡åŠ è½½å»¶è¿Ÿï¼ˆmsï¼‰\n            }\n        };\n\n        // Viewerå®ä¾‹ç®¡ç† - ä¼˜åŒ–æ›´æ–°é¢‘ç‡\n        const viewerManager = {\n            instance: null,\n            updateTimer: null,\n            init() {\n                if (this.instance) return;\n                this.instance = new Viewer(document.querySelector('.gallery'), {\n                    ...CONFIG.viewer,\n                    url: 'data-src'\n                });\n            },\n            // é˜²æŠ–æ›´æ–°ï¼Œå‡å°‘DOMæ“ä½œ\n            update() {\n                if (this.updateTimer) clearTimeout(this.updateTimer);\n                this.updateTimer = setTimeout(() => {\n                    this.instance?.update();\n                    this.updateTimer = null;\n                }, 100);\n            },\n            destroy() {\n                if (this.instance) {\n                    try {\n                        this.instance.destroy();\n                        document.querySelectorAll('.viewer-container').forEach(container => container.remove());\n                    } catch (e) {\n                        console.error('Vieweré”€æ¯å¤±è´¥:', e);\n                    }\n                    this.instance = null;\n                }\n            }\n        };\n\n        // å›¾ç‰‡åŠ è½½æ§åˆ¶ - æ ¸å¿ƒä¼˜åŒ–\n        const imageLoader = {\n            loadingCount: 0, // å½“å‰åŠ è½½ä¸­çš„å›¾ç‰‡æ•°\n            imageQueue: [],  // å¾…åŠ è½½å›¾ç‰‡é˜Ÿåˆ—\n\n            // åˆå§‹åŒ–åŠ è½½é˜Ÿåˆ—\n            initQueue() {\n                this.imageQueue = Array.from(document.querySelectorAll('.gallery img'));\n                // å¯åŠ¨å¹¶å‘åŠ è½½\n                this.loadNextBatch();\n            },\n\n            // åŠ è½½ä¸‹ä¸€æ‰¹å›¾ç‰‡\n            loadNextBatch() {\n                // è¿˜æœ‰å¾…åŠ è½½å›¾ç‰‡ && å½“å‰åŠ è½½æ•° < æœ€å¤§å¹¶å‘æ•°\n                while (this.imageQueue.length > 0 && this.loadingCount < CONFIG.load.concurrency) {\n                    const img = this.imageQueue.shift();\n                    this.loadImage(img);\n                }\n            },\n\n            // å•å¼ å›¾ç‰‡åŠ è½½é€»è¾‘\n            loadImage(img, attempt = 1) {\n                // é˜²æ­¢é‡å¤åŠ è½½\n                if (img.hasAttribute('loading') || img.src || img.parentElement.classList.contains('error')) {\n                    this.loadingCount--;\n                    this.loadNextBatch();\n                    return;\n                }\n\n                img.setAttribute('loading', '');\n                this.loadingCount++;\n\n                // ç§»é™¤æ—¶é—´æˆ³ï¼Œåˆ©ç”¨æµè§ˆå™¨ç¼“å­˜\n                const src = img.dataset.src;\n                const tempImg = new Image();\n\n                tempImg.onload = () => {\n                    // æå‰è®¡ç®—å®½é«˜æ¯”ï¼Œå‡å°‘å¸ƒå±€é—ªçƒ\n                    const aspectRatio = tempImg.naturalWidth / tempImg.naturalHeight;\n                    if (aspectRatio > 1) {\n                        img.parentElement.style.setProperty('--aspect-ratio', 4/3);\n                    }\n\n                    img.src = src;\n                    img.setAttribute('loaded', '');\n                    img.removeAttribute('loading');\n\n                    this.loadingCount--;\n                    this.scheduleViewerUpdate();\n\n                    // å»¶è¿ŸåŠ è½½ä¸‹ä¸€æ‰¹ï¼Œé¿å…ç¬é—´è¯·æ±‚\n                    setTimeout(() => {\n                        this.loadNextBatch();\n                    }, CONFIG.load.batchDelay);\n                };\n\n                tempImg.onerror = () => {\n                    img.removeAttribute('loading');\n                    this.handleError(img, attempt);\n                };\n\n                // ä¼˜åŒ–ï¼šæ·»åŠ è¶…æ—¶å¤„ç†\n                tempImg.timeoutId = setTimeout(() => {\n                    tempImg.onerror();\n                }, 10000); // 10ç§’è¶…æ—¶\n\n                tempImg.src = src;\n            },\n\n            // é”™è¯¯å¤„ç†ï¼ˆä¿®å¤é‡è¯•è®¡æ•°ï¼‰\n            handleError(img, attempt) {\n                this.loadingCount--;\n\n                // é‡è¯•æ¬¡æ•°æœªè¾¾ä¸Šé™\n                if (attempt < CONFIG.retry.maxAttempts) {\n                    const delay = CONFIG.retry.initialDelay * Math.pow(CONFIG.retry.backoff, attempt - 1);\n                    setTimeout(() => {\n                        // é‡æ–°åŠ å…¥é˜Ÿåˆ—æœ«å°¾\n                        this.imageQueue.push(img);\n                        this.loadNextBatch();\n                    }, delay);\n                } else {\n                    // é‡è¯•å¤±è´¥\n                    img.parentElement.classList.add('error');\n                    img.alt = 'å›¾ç‰‡åŠ è½½å¤±è´¥';\n                    this.scheduleViewerUpdate();\n                    // åŠ è½½ä¸‹ä¸€å¼ \n                    this.loadNextBatch();\n                }\n            },\n\n            scheduleViewerUpdate() {\n                viewerManager.update();\n            }\n        };\n\n        // é¡µé¢åˆå§‹åŒ–\n        document.addEventListener('DOMContentLoaded', () => {\n            viewerManager.init();\n            imageLoader.initQueue();\n        });\n\n        // çª—å£å˜åŒ–æ—¶é˜²æŠ–æ›´æ–°\n        window.addEventListener('resize', () => {\n            viewerManager.update();\n        });\n\n        // é¡µé¢å¸è½½æ—¶é”€æ¯\n        window.addEventListener('beforeunload', () => {\n            viewerManager.destroy();\n        });\n    </script>\n</body>\n</html>`;\n}",
    "lastUpdateTime": 1768392765632,
    "loadWithBaseUrl": true,
    "preload": false,
    "ruleArticles": "class.card-columns@class.card",
    "ruleContent": ".imgHolder img@src\n<js>\nresult = getHtml(getImgTag(result));\n</js>",
    "ruleImage": "img@src",
    "ruleLink": "class.visited@href",
    "ruleNextPage": "class.next@a@href",
    "ruleTitle": "class.card-body@text\n<js>\njava.t2s(result);\n</js>",
    "showWebLog": false,
    "singleUrl": false,
    "sortUrl": "æå“ç¾å¥³::/cat/11\næ¸…å‡‰å†™çœŸ::/cat/3\næ€§æ„Ÿæ¿€æƒ…::/cat/7\næ¬§ç¾å†™çœŸ::/cat/1\nç¾å¥³å›¾::/cat/5\nä¸è¢œç¾è…¿::/cat/4\nCOSPLAY::/cat/8\näºšæ´²ç¾å¥³::/cat/9\nç´ äººæ­£å¦¹::/cat/6\nChinese::/cat/17\næ¬§ç¾ç¾å¥³::/cat/10\nGravure::/cat/12\nAidol::/cat/13\nThailand::/cat/16\nKorea::/cat/15\nå›½äº§ç¾å¥³::/cat/21\næ¸¯å°ç¾å¥³::/cat/20\nMagazine::/cat/14\næ—¥éŸ©ç¾å¥³::/cat/19\nå¤œåº—è¾£å¦¹::/cat/2",
    "sourceGroup": "å›¾ç‰‡",
    "sourceIcon": "https://i02piccdn.sogoucdn.com/d88ab267014ea98d",
    "sourceName": "ğŸ“–å›¾ç‰‡18",
    "sourceUrl": "https://www.photos18.com/",
    "type": 0
  },
  {
    "articleStyle": 3,
    "cacheFirst": false,
    "customOrder": 82,
    "enableJs": true,
    "enabled": true,
    "enabledCookieJar": false,
    "header": "{\"User-Agent\":\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Safari/537.36\"}",
    "jsLib": "function getHtml(params) {\n    return `<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n    <title>å›¾ç‰‡</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.css\">\n    <style>\n        :root {\n            --item-width: 97vw;\n            --aspect-ratio: 65/100;\n        }\n\n        body {\n            margin: 0;\n            padding: 20px 0;\n            background-color: floralwhite;\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n            min-height: 100vh;\n        }\n\n        .gallery {\n            list-style: none;\n            padding: 0;\n            margin: 0 auto;\n            width: calc(var(--item-width) - 30px);\n            max-width: 400px;\n        }\n\n            .gallery li {\n                width: 100%;\n                margin-bottom: 15px;\n                background: floralwhite;\n                border-radius: 8px;\n                overflow: hidden;\n                position: relative;\n                height: 0;\n                padding-top: calc(100% / (var(--aspect-ratio, 3/4)));\n                box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n            }\n\n            .gallery img {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                object-fit: cover;\n                opacity: 0;\n                transition: opacity 0.4s ease-out;\n            }\n\n                .gallery img[loaded] {\n                    opacity: 1;\n                }\n\n                .gallery img.error {\n                    filter: grayscale(1);\n                    background: repeating-linear-gradient(45deg, #f1f3f5, #f1f3f5 10px, #e9ecef 10px, #e9ecef 20px);\n                    color: #ff6b6b;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    font-size: 14px;\n                }\n\n        #load-status {\n            text-align: center;\n            padding: 15px;\n            color: #666;\n        }\n    </style>\n</head>\n<body>\n    <ul class=\"gallery\"></ul>\n    <div id=\"load-status\"></div>\n\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.js\"></script>\n    <script>\n        const CONFIG = {\n            totalPage: ${params.totalPage},\n            baseUrl: \"${params.baseUrl}\",\n            pageUrlTemplate: \"${params.pageUrlTemplate}\",\n            imageSelector: \"${params.imageSelector}\",\n            errorText: \"åŠ è½½å¤±è´¥\",\n            endText: \"å·²åŠ è½½å…¨éƒ¨å†…å®¹\",\n            loadPages: 2,\n            retry: { maxAttempts: 3, initialDelay: 1000, backoff: 2 },\n            viewer: { toolbar: { zoomIn: 1, zoomOut: 1, oneToOne: 1, reset: 1 }, transition: false, navbar: false, title: false },\n            selectors: { gallery: '.gallery', loadStatus: '#load-status', sentinel: '#load-sentinel' },\n            observer: { rootMargin: '800px', threshold: 0.01 },\n            imageLoad: {\n                batchSize: 3, // æ¯æ‰¹åŠ è½½3å¼ \n                viewportFirst: true, // é¦–å±å›¾ç‰‡ä¼˜å…ˆåŠ è½½\n                cache: true // å¯ç”¨å›¾ç‰‡ç¼“å­˜\n            }\n        };\n\n        let page = 1;\n        let isLoading = false;\n        let loadFailed = false;\n        let pageObserver = null;\n        const imageAbortControllers = new Map();\n\n        // --- 1. Viewer.js ç®¡ç† ---\n        const viewerManager = {\n            instance: null,\n            updateTimer: null,\n            init() {\n                if (this.instance) return;\n                this.instance = new Viewer(document.querySelector(CONFIG.selectors.gallery), {\n                    ...CONFIG.viewer,\n                    url: 'data-src'\n                });\n            },\n            // é˜²æŠ–æ›´æ–°Viewerï¼Œå‡å°‘é‡ç»˜\n            update() {\n                clearTimeout(this.updateTimer);\n                this.updateTimer = setTimeout(() => {\n                    this.instance?.update();\n                }, 100);\n            },\n            destroy() {\n                clearTimeout(this.updateTimer);\n                this.instance?.destroy();\n                // ä¸­æ–­æ‰€æœ‰æœªå®Œæˆçš„å›¾ç‰‡è¯·æ±‚\n                imageAbortControllers.forEach(controller => controller.abort());\n                imageAbortControllers.clear();\n            }\n        };\n\n        // --- 2. å›¾ç‰‡åŠ è½½é€»è¾‘ ---\n        const imageLoader = {\n            // å¼‚æ­¥ä¸²è¡Œåˆ†æ‰¹åŠ è½½å›¾ç‰‡\n            async loadImagesInOrder(imgs) {\n                if (!imgs.length) return;\n\n                // æ­¥éª¤1ï¼šåˆ†ç¦»é¦–å±/éé¦–å±å›¾ç‰‡\n                const [viewportImgs, otherImgs] = CONFIG.imageLoad.viewportFirst\n                    ? this.splitViewportImages(imgs)\n                    : [[], imgs];\n\n                // æ­¥éª¤2ï¼šå…ˆåŠ è½½é¦–å±å›¾ç‰‡\n                await this.loadImageBatch(viewportImgs);\n                // æ­¥éª¤3ï¼šåˆ†æ‰¹åŠ è½½å‰©ä½™å›¾ç‰‡\n                for (let i = 0; i < otherImgs.length; i += CONFIG.imageLoad.batchSize) {\n                    const batch = otherImgs.slice(i, i + CONFIG.imageLoad.batchSize);\n                    await this.loadImageBatch(batch);\n                }\n            },\n\n            // åŠ è½½å•æ‰¹å›¾ç‰‡\n            async loadImageBatch(imgs) {\n                if (!imgs.length) return Promise.resolve();\n                const promises = imgs.map(img => this.loadImage(img));\n                await Promise.allSettled(promises); // ä¸é˜»å¡æ‰¹æ¬¡åŠ è½½\n            },\n\n            // åˆ†ç¦»è§†å£å†…/å¤–å›¾ç‰‡\n            splitViewportImages(imgs) {\n                const viewportImgs = [];\n                const otherImgs = [];\n                const viewportHeight = window.innerHeight;\n\n                imgs.forEach(img => {\n                    const rect = img.getBoundingClientRect();\n                    // å›¾ç‰‡è¿›å…¥/å³å°†è¿›å…¥è§†å£ï¼ˆæå‰200pxï¼‰\n                    const isInViewport = rect.top < viewportHeight + 200 && rect.bottom > -200;\n                    isInViewport ? viewportImgs.push(img) : otherImgs.push(img);\n                });\n                return [viewportImgs, otherImgs];\n            },\n\n            // åŠ è½½å•å¼ å›¾ç‰‡\n            loadImage(img) {\n                // è·³è¿‡å·²åŠ è½½/å¤±è´¥/åŠ è½½ä¸­çš„å›¾ç‰‡\n                if (img.hasAttribute('loaded') || img.classList.contains('error')) return Promise.resolve();\n                if (img.hasAttribute('loading')) return new Promise(resolve => {\n                    // ç›‘å¬åŠ è½½å®Œæˆï¼ˆé¿å…é‡å¤è¯·æ±‚ï¼‰\n                    const onLoad = () => { resolve(); img.removeEventListener('load', onLoad); };\n                    const onError = () => { resolve(); img.removeEventListener('error', onError); };\n                    img.addEventListener('load', onLoad);\n                    img.addEventListener('error', onError);\n                });\n\n                // æ ‡è®°åŠ è½½ä¸­\n                img.setAttribute('loading', '');\n                // åˆå§‹åŒ–é‡è¯•æ¬¡æ•°ï¼ˆå­˜åœ¨åˆ™å¤ç”¨ï¼‰\n                const attempt = parseInt(img.dataset.retryAttempt || 1);\n                // åˆ›å»ºä¸­æ–­æ§åˆ¶å™¨\n                const controller = new AbortController();\n                const signal = controller.signal;\n                imageAbortControllers.set(img, controller);\n\n                return new Promise((resolve) => {\n                    const src = CONFIG.imageLoad.cache && attempt === 1\n                        ? img.dataset.src\n                        : img.dataset.src + '?t=' + Date.now();\n\n                    const tempImg = new Image();\n                    tempImg.signal = signal;\n\n                    tempImg.onload = () => {\n                        this.handleSuccess(img, tempImg);\n                        imageAbortControllers.delete(img);\n                        resolve();\n                    };\n\n                    tempImg.onerror = () => {\n                        this.handleError(img, attempt).then(resolve).catch(resolve);\n                        imageAbortControllers.delete(img);\n                    };\n\n                    // ç›‘å¬ä¸­æ–­ä¿¡å·\n                    signal.addEventListener('abort', () => {\n                        img.removeAttribute('loading');\n                        resolve();\n                    });\n\n                    tempImg.src = src;\n                });\n            },\n\n            // åŠ è½½æˆåŠŸå¤„ç†\n            handleSuccess(img, tempImg) {\n                img.removeAttribute('loading');\n                // æå‰è®¡ç®—å®½é«˜æ¯”ï¼Œå‡å°‘å¸ƒå±€æŠ–åŠ¨\n                const aspectRatio = tempImg.naturalWidth / tempImg.naturalHeight;\n                if (aspectRatio > 1) {\n                    img.parentElement.style.setProperty('--aspect-ratio', '4 / 3');\n                }\n                // å¼‚æ­¥è®¾ç½®srcï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹\n                requestAnimationFrame(() => {\n                    img.src = tempImg.src;\n                    img.setAttribute('loaded', '');\n                    viewerManager.update();\n                });\n            },\n\n            // åŠ è½½å¤±è´¥å¤„ç†ï¼ˆä¸¥è°¨çš„é‡è¯•é€»è¾‘ï¼‰\n            async handleError(img, attempt) {\n                img.removeAttribute('loading');\n                // è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°\n                if (attempt >= CONFIG.retry.maxAttempts) {\n                    img.classList.add('error');\n                    img.alt = 'å›¾ç‰‡åŠ è½½å¤±è´¥';\n                    viewerManager.update();\n                    return;\n                }\n\n                // è®°å½•å½“å‰é‡è¯•æ¬¡æ•°\n                img.dataset.retryAttempt = attempt + 1;\n                // è®¡ç®—é€€é¿æ—¶é—´ï¼ˆæŒ‡æ•°é€€é¿ï¼‰\n                const delay = CONFIG.retry.initialDelay * Math.pow(CONFIG.retry.backoff, attempt - 1);\n\n                // å»¶è¿Ÿé‡è¯•\n                await new Promise(resolve => setTimeout(resolve, delay));\n                // é‡è¯•åŠ è½½\n                await this.loadImage(img);\n            }\n        };\n\n        // --- 3. é¡µé¢çº§æ— é™æ»šåŠ¨è§¦å‘ ---\n        function initPagination() {\n            const sentinel = document.createElement('div');\n            sentinel.id = CONFIG.selectors.sentinel.slice(1);\n            document.querySelector(CONFIG.selectors.gallery).after(sentinel);\n\n            pageObserver = new IntersectionObserver(entries => {\n                if (entries[0].isIntersecting && !isLoading && !loadFailed) {\n                    loadMorePages();\n                }\n            }, CONFIG.observer);\n            pageObserver.observe(sentinel);\n        }\n\n        // --- 4. é¡µé¢æ•°æ®è¯·æ±‚ ---\n        async function fetchPage(p) {\n            try {\n                const url = CONFIG.pageUrlTemplate.replace(\"{baseUrl}\", CONFIG.baseUrl).replace(\"{page}\", p);\n                const response = await fetch(url);\n                if (!response.ok) throw new Error('HTTP error! status: ' + response.status);\n                const text = await response.text();\n                const doc = new DOMParser().parseFromString(text, 'text/html');\n                return Array.from(doc.querySelectorAll(CONFIG.imageSelector)).map(img => img.src);\n            } catch (error) {\n                throw new Error('ç¬¬' + p + 'é¡µåŠ è½½å¤±è´¥: ' + error.message);\n            }\n        }\n\n        // --- 5. å›¾ç‰‡DOMæ’å…¥ + ä¼˜åŒ–åŠ è½½ ---\n        function appendImagesToDOM(imageUrls) {\n            const fragment = document.createDocumentFragment();\n            const gallery = document.querySelector(CONFIG.selectors.gallery);\n            const newImgs = [];\n\n            imageUrls.forEach(src => {\n                const li = document.createElement('li');\n                const img = document.createElement('img');\n                img.dataset.src = src;\n                img.alt = 'å†™çœŸ';\n                li.appendChild(img);\n                fragment.appendChild(li);\n                newImgs.push(img);\n            });\n\n            gallery.appendChild(fragment);\n            // å¯åŠ¨é¡ºåºåŠ è½½\n            imageLoader.loadImagesInOrder(newImgs);\n            viewerManager.update();\n        }\n\n        // --- 6. åŠ è½½ä¸‹ä¸€é¡µæ•°æ® ---\n        async function loadMorePages() {\n            if (page > CONFIG.totalPage) {\n                document.querySelector(CONFIG.selectors.loadStatus).textContent = CONFIG.endText;\n                pageObserver?.disconnect();\n                return;\n            }\n\n            isLoading = true;\n            document.querySelector(CONFIG.selectors.loadStatus).textContent = 'åŠ è½½ä¸­...';\n\n            try {\n                const promises = [];\n                for (let i = 0; i < CONFIG.loadPages && (page + i) <= CONFIG.totalPage; i++) {\n                    promises.push(fetchPage(page + i));\n                }\n\n                const results = await Promise.all(promises);\n                const allNewImages = results.flat();\n\n                if (allNewImages.length > 0) {\n                    appendImagesToDOM(allNewImages);\n                    page += CONFIG.loadPages;\n                } else {\n                    throw new Error(\"æœªè·å–åˆ°æ–°å›¾ç‰‡\");\n                }\n\n                if (page > CONFIG.totalPage) {\n                    document.querySelector(CONFIG.selectors.loadStatus).textContent = CONFIG.endText;\n                    pageObserver?.disconnect();\n                }\n\n            } catch (error) {\n                console.error(error);\n                document.querySelector(CONFIG.selectors.loadStatus).innerHTML = '< span style = \"color:red\" >' + CONFIG.errorText + '</span >';\n                loadFailed = true;\n            } finally {\n                isLoading = false;\n            }\n        }\n\n        // --- åˆå§‹åŒ– ---\n        document.addEventListener('DOMContentLoaded', () => {\n            viewerManager.init();\n            initPagination();\n            loadMorePages();\n        });\n\n        window.addEventListener('resize', () => viewerManager.update());\n        window.addEventListener('beforeunload', () => viewerManager.destroy());\n    </script>\n</body>\n</html>`;\n}",
    "lastUpdateTime": 1768401066223,
    "loadWithBaseUrl": true,
    "preload": false,
    "ruleArticles": "class.title||id.dlNews@tag.td||class.imglist@li",
    "ruleContent": "@js:\nlet params = {\n    totalPage: String(java.getString(\"@@class.pager@tag.li.-3@tag.a@text\")),//æ€»é¡µæ•°\n    baseUrl: `${baseUrl.replace('.aspx', 'p')}`,//æå–é“¾æ¥\n    pageUrlTemplate: \"{baseUrl}{page}.aspx\", //ä¸‹ä¸€é¡µURLæ¨¡æ¿\n    imageSelector: \"#content img\", //cssé€‰æ‹©å™¨\n}\ngetHtml(params)",
    "ruleImage": "tag.img@src",
    "ruleLink": "tag.a.0@href",
    "ruleNextPage": "@css:[title=\"åé¡µ\"]@href##$##,{'retry': 9}",
    "rulePubDate": ".date.0@textNodes",
    "ruleTitle": "tag.img@alt||tag.a.0@text",
    "searchUrl": "https://www.24mi.cc/search.aspx?keyword={{key}}&where=title",
    "showWebLog": false,
    "singleUrl": false,
    "sortUrl": "é¦–é¡µ::/mc49.aspx\næœç´¢::https://www.24mi.cc/search.aspx?keyword={{source.getVariable()==''?'æ— åœ£å…‰':source.getVariable()}}&where=title\néšæœº::/mc49p{{Math.ceil(Math.random()*100)}}.aspx",
    "sourceComment": "//www.2488.one",
    "sourceGroup": "å›¾ç‰‡",
    "sourceIcon": "https://i03piccdn.sogoucdn.com/a6841db4ae1847cf",
    "sourceName": "24FAç¾å¥³é¢‘é“",
    "sourceUrl": "https://www.24mi.cc/",
    "type": 0
  },
  {
    "articleStyle": 3,
    "cacheFirst": false,
    "customOrder": 85,
    "enableJs": true,
    "enabled": true,
    "enabledCookieJar": true,
    "header": "{\"Referer\":\"https://everia.club/\",\"User-Agent\":\"Mozilla/5.0 (Linux; Android 14; 2211133C Build/UKQ1.230804.001) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.6422.165 Mobile Safari/537.36\"}",
    "jsLib": "function getImgTag(link) {\n    if (typeof link !== 'string' || link.trim() === '') {\n        return '';\n    }\n\n    const list = link.split('\\n')\n        .map(item => item.trim())\n        .filter(item => item !== '');\n\n    if (list.length === 0) {\n        return '';\n    }\n\n    const imgTags = list.reduce((acc, url) => {\n        if (url.startsWith('http://') || url.startsWith('https://')) {\n            acc.push(`<li><img data-src=\"${url}\" alt=\"å›¾ç‰‡\"></li>`);\n        }\n        return acc;\n    }, []);\n\n    return '\\n' + imgTags.join('\\n') + '\\n';\n}\n\nfunction getHtml(imgTag) {\n    return `<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n    <title>å›¾ç‰‡</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.css\">\n    <style>\n        :root {\n            --item-width: 97vw;\n            --aspect-ratio: 65/100;\n        }\n\n        body {\n            margin: 0;\n            padding: 20px 0;\n            background-color: floralwhite;\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n            min-height: 100vh;\n        }\n\n        .gallery {\n            list-style: none;\n            padding: 0;\n            margin: 0 auto;\n            width: calc(var(--item-width) - 30px);\n            max-width: 400px;\n        }\n\n            .gallery li {\n                width: 100%;\n                margin-bottom: 15px;\n                background: floralwhite;\n                border-radius: 8px;\n                overflow: hidden;\n                position: relative;\n                height: 0;\n                padding-top: calc(100% / (var(--aspect-ratio, 3/4)));\n                box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n                /* é¢„åŠ è½½å ä½ï¼Œå‡å°‘é—ªçƒ */\n                background: #f8f9fa;\n            }\n\n                .gallery li.error {\n                    background: repeating-linear-gradient( 45deg, #f1f3f5, #f1f3f5 10px, #e9ecef 10px, #e9ecef 20px );\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    color: #ff6b6b;\n                    font-size: 14px;\n                }\n\n                    .gallery li.error::after {\n                        content: \"åŠ è½½å¤±è´¥\";\n                    }\n\n            .gallery img {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                object-fit: cover;\n                opacity: 0;\n                transition: opacity 0.4s ease-out;\n                /* æå‡å›¾ç‰‡æ¸²æŸ“æ€§èƒ½ */\n                will-change: opacity;\n            }\n\n                .gallery img[loaded] {\n                    opacity: 1;\n                }\n    </style>\n</head>\n<body>\n    <ul class=\"gallery\">\n        ${imgTag}\n    </ul>\n\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.js\"></script>\n    <script>\n        const CONFIG = {\n            retry: {\n                maxAttempts: 3,\n                initialDelay: 1000,\n                backoff: 2\n            },\n            viewer: {\n                toolbar: {\n                    zoomIn: 1,\n                    zoomOut: 1,\n                    oneToOne: 1,\n                    reset: 1\n                },\n                transition: false,\n                navbar: false,\n                title: false\n            },\n            // å¹¶å‘æ§åˆ¶é…ç½®\n            load: {\n                concurrency: 3, // åŒæ—¶åŠ è½½çš„å›¾ç‰‡æ•°é‡\n                batchDelay: 300 // æ‰¹æ¬¡åŠ è½½å»¶è¿Ÿï¼ˆmsï¼‰\n            }\n        };\n\n        // Viewerå®ä¾‹ç®¡ç† - ä¼˜åŒ–æ›´æ–°é¢‘ç‡\n        const viewerManager = {\n            instance: null,\n            updateTimer: null,\n            init() {\n                if (this.instance) return;\n                this.instance = new Viewer(document.querySelector('.gallery'), {\n                    ...CONFIG.viewer,\n                    url: 'data-src'\n                });\n            },\n            // é˜²æŠ–æ›´æ–°ï¼Œå‡å°‘DOMæ“ä½œ\n            update() {\n                if (this.updateTimer) clearTimeout(this.updateTimer);\n                this.updateTimer = setTimeout(() => {\n                    this.instance?.update();\n                    this.updateTimer = null;\n                }, 100);\n            },\n            destroy() {\n                if (this.instance) {\n                    try {\n                        this.instance.destroy();\n                        document.querySelectorAll('.viewer-container').forEach(container => container.remove());\n                    } catch (e) {\n                        console.error('Vieweré”€æ¯å¤±è´¥:', e);\n                    }\n                    this.instance = null;\n                }\n            }\n        };\n\n        // å›¾ç‰‡åŠ è½½æ§åˆ¶ - æ ¸å¿ƒä¼˜åŒ–\n        const imageLoader = {\n            loadingCount: 0, // å½“å‰åŠ è½½ä¸­çš„å›¾ç‰‡æ•°\n            imageQueue: [],  // å¾…åŠ è½½å›¾ç‰‡é˜Ÿåˆ—\n\n            // åˆå§‹åŒ–åŠ è½½é˜Ÿåˆ—\n            initQueue() {\n                this.imageQueue = Array.from(document.querySelectorAll('.gallery img'));\n                // å¯åŠ¨å¹¶å‘åŠ è½½\n                this.loadNextBatch();\n            },\n\n            // åŠ è½½ä¸‹ä¸€æ‰¹å›¾ç‰‡\n            loadNextBatch() {\n                // è¿˜æœ‰å¾…åŠ è½½å›¾ç‰‡ && å½“å‰åŠ è½½æ•° < æœ€å¤§å¹¶å‘æ•°\n                while (this.imageQueue.length > 0 && this.loadingCount < CONFIG.load.concurrency) {\n                    const img = this.imageQueue.shift();\n                    this.loadImage(img);\n                }\n            },\n\n            // å•å¼ å›¾ç‰‡åŠ è½½é€»è¾‘\n            loadImage(img, attempt = 1) {\n                // é˜²æ­¢é‡å¤åŠ è½½\n                if (img.hasAttribute('loading') || img.src || img.parentElement.classList.contains('error')) {\n                    this.loadingCount--;\n                    this.loadNextBatch();\n                    return;\n                }\n\n                img.setAttribute('loading', '');\n                this.loadingCount++;\n\n                // ç§»é™¤æ—¶é—´æˆ³ï¼Œåˆ©ç”¨æµè§ˆå™¨ç¼“å­˜\n                const src = img.dataset.src;\n                const tempImg = new Image();\n\n                tempImg.onload = () => {\n                    // æå‰è®¡ç®—å®½é«˜æ¯”ï¼Œå‡å°‘å¸ƒå±€é—ªçƒ\n                    const aspectRatio = tempImg.naturalWidth / tempImg.naturalHeight;\n                    if (aspectRatio > 1) {\n                        img.parentElement.style.setProperty('--aspect-ratio', 4/3);\n                    }\n\n                    img.src = src;\n                    img.setAttribute('loaded', '');\n                    img.removeAttribute('loading');\n\n                    this.loadingCount--;\n                    this.scheduleViewerUpdate();\n\n                    // å»¶è¿ŸåŠ è½½ä¸‹ä¸€æ‰¹ï¼Œé¿å…ç¬é—´è¯·æ±‚\n                    setTimeout(() => {\n                        this.loadNextBatch();\n                    }, CONFIG.load.batchDelay);\n                };\n\n                tempImg.onerror = () => {\n                    img.removeAttribute('loading');\n                    this.handleError(img, attempt);\n                };\n\n                // ä¼˜åŒ–ï¼šæ·»åŠ è¶…æ—¶å¤„ç†\n                tempImg.timeoutId = setTimeout(() => {\n                    tempImg.onerror();\n                }, 10000); // 10ç§’è¶…æ—¶\n\n                tempImg.src = src;\n            },\n\n            // é”™è¯¯å¤„ç†ï¼ˆä¿®å¤é‡è¯•è®¡æ•°ï¼‰\n            handleError(img, attempt) {\n                this.loadingCount--;\n\n                // é‡è¯•æ¬¡æ•°æœªè¾¾ä¸Šé™\n                if (attempt < CONFIG.retry.maxAttempts) {\n                    const delay = CONFIG.retry.initialDelay * Math.pow(CONFIG.retry.backoff, attempt - 1);\n                    setTimeout(() => {\n                        // é‡æ–°åŠ å…¥é˜Ÿåˆ—æœ«å°¾\n                        this.imageQueue.push(img);\n                        this.loadNextBatch();\n                    }, delay);\n                } else {\n                    // é‡è¯•å¤±è´¥\n                    img.parentElement.classList.add('error');\n                    img.alt = 'å›¾ç‰‡åŠ è½½å¤±è´¥';\n                    this.scheduleViewerUpdate();\n                    // åŠ è½½ä¸‹ä¸€å¼ \n                    this.loadNextBatch();\n                }\n            },\n\n            scheduleViewerUpdate() {\n                viewerManager.update();\n            }\n        };\n\n        // é¡µé¢åˆå§‹åŒ–\n        document.addEventListener('DOMContentLoaded', () => {\n            viewerManager.init();\n            imageLoader.initQueue();\n        });\n\n        // çª—å£å˜åŒ–æ—¶é˜²æŠ–æ›´æ–°\n        window.addEventListener('resize', () => {\n            viewerManager.update();\n        });\n\n        // é¡µé¢å¸è½½æ—¶é”€æ¯\n        window.addEventListener('beforeunload', () => {\n            viewerManager.destroy();\n        });\n    </script>\n</body>\n</html>`;\n}",
    "lastUpdateTime": 1768395467447,
    "loadWithBaseUrl": true,
    "preload": false,
    "ruleArticles": "id.blog-entries@class.blog-entry",
    "ruleContent": "class.wp-block-gallery@class.wp-block-image@tag.img@data-lazy-src\n<js>\nresult = getHtml(getImgTag(result));\n</js>",
    "ruleImage": "a.0@img@data-lazy-src",
    "ruleLink": "a.0@href",
    "ruleNextPage": "class.page-numbers@li.-1@a@href",
    "ruleTitle": "h2@text",
    "showWebLog": false,
    "singleUrl": false,
    "sortUrl": "cosplay::https://everia.club/category/cosplay/\nchina::https://everia.club/category/chinese/\ngravure::https://everia.club/category/gravure/\nkorea::https://everia.club/category/korea/\njapan::https://everia.club/category/japan/\nthailand::https://everia.club/category/thailand/",
    "sourceComment": "/*\n\tby å¹³é™ 2025/4/18\n\tå›¾ç‰‡ä¸åˆ†é¡µçš„æ­£æ–‡è§„åˆ™æ¨¡æ¿\n\t*/",
    "sourceGroup": "å›¾ç‰‡",
    "sourceIcon": "https://img401.imagehaha.com/th/53329/u36oofme0kfv.jpg",
    "sourceName": "EVERIA",
    "sourceUrl": "https://everia.club/category/cosplay/",
    "type": 0
  },
  {
    "articleStyle": 2,
    "cacheFirst": false,
    "customOrder": 86,
    "enableJs": true,
    "enabled": true,
    "enabledCookieJar": true,
    "header": "{\n  \"User-Agent\": \"Mozilla/5.0 (Linux; Android 16; 2211133C Build/BP2A.250605.031.A3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.7499.34 Mobile Safari/537.36\"\n}",
    "jsLib": "function getHtml(params) {\n    return `<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n    <title>å›¾ç‰‡</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.css\">\n    <style>\n        :root {\n            --item-width: 97vw;\n            --aspect-ratio: 65/100;\n        }\n\n        body {\n            margin: 0;\n            padding: 20px 0;\n            background-color: floralwhite;\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n            min-height: 100vh;\n        }\n\n        .gallery {\n            list-style: none;\n            padding: 0;\n            margin: 0 auto;\n            width: calc(var(--item-width) - 30px);\n            max-width: 400px;\n        }\n\n            .gallery li {\n                width: 100%;\n                margin-bottom: 15px;\n                background: floralwhite;\n                border-radius: 8px;\n                overflow: hidden;\n                position: relative;\n                height: 0;\n                padding-top: calc(100% / (var(--aspect-ratio, 3/4)));\n                box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n            }\n\n            .gallery img {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                object-fit: cover;\n                opacity: 0;\n                transition: opacity 0.4s ease-out;\n            }\n\n                .gallery img[loaded] {\n                    opacity: 1;\n                }\n\n                .gallery img.error {\n                    filter: grayscale(1);\n                    background: repeating-linear-gradient(45deg, #f1f3f5, #f1f3f5 10px, #e9ecef 10px, #e9ecef 20px);\n                    color: #ff6b6b;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    font-size: 14px;\n                }\n\n        #load-status {\n            text-align: center;\n            padding: 15px;\n            color: #666;\n        }\n    </style>\n</head>\n<body>\n    <ul class=\"gallery\"></ul>\n    <div id=\"load-status\"></div>\n\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.js\"></script>\n    <script>\n        const CONFIG = {\n            totalPage: ${params.totalPage},\n            baseUrl: \"${params.baseUrl}\",\n            pageUrlTemplate: \"${params.pageUrlTemplate}\",\n            imageSelector: \"${params.imageSelector}\",\n            errorText: \"åŠ è½½å¤±è´¥\",\n            endText: \"å·²åŠ è½½å…¨éƒ¨å†…å®¹\",\n            loadPages: 2,\n            retry: { maxAttempts: 3, initialDelay: 1000, backoff: 2 },\n            viewer: { toolbar: { zoomIn: 1, zoomOut: 1, oneToOne: 1, reset: 1 }, transition: false, navbar: false, title: false },\n            selectors: { gallery: '.gallery', loadStatus: '#load-status', sentinel: '#load-sentinel' },\n            observer: { rootMargin: '800px', threshold: 0.01 },\n            imageLoad: {\n                batchSize: 3, // æ¯æ‰¹åŠ è½½3å¼ \n                viewportFirst: true, // é¦–å±å›¾ç‰‡ä¼˜å…ˆåŠ è½½\n                cache: true // å¯ç”¨å›¾ç‰‡ç¼“å­˜\n            }\n        };\n\n        let page = 1;\n        let isLoading = false;\n        let loadFailed = false;\n        let pageObserver = null;\n        const imageAbortControllers = new Map();\n\n        // --- 1. Viewer.js ç®¡ç† ---\n        const viewerManager = {\n            instance: null,\n            updateTimer: null,\n            init() {\n                if (this.instance) return;\n                this.instance = new Viewer(document.querySelector(CONFIG.selectors.gallery), {\n                    ...CONFIG.viewer,\n                    url: 'data-src'\n                });\n            },\n            // é˜²æŠ–æ›´æ–°Viewerï¼Œå‡å°‘é‡ç»˜\n            update() {\n                clearTimeout(this.updateTimer);\n                this.updateTimer = setTimeout(() => {\n                    this.instance?.update();\n                }, 100);\n            },\n            destroy() {\n                clearTimeout(this.updateTimer);\n                this.instance?.destroy();\n                // ä¸­æ–­æ‰€æœ‰æœªå®Œæˆçš„å›¾ç‰‡è¯·æ±‚\n                imageAbortControllers.forEach(controller => controller.abort());\n                imageAbortControllers.clear();\n            }\n        };\n\n        // --- 2. å›¾ç‰‡åŠ è½½é€»è¾‘ ---\n        const imageLoader = {\n            // å¼‚æ­¥ä¸²è¡Œåˆ†æ‰¹åŠ è½½å›¾ç‰‡\n            async loadImagesInOrder(imgs) {\n                if (!imgs.length) return;\n\n                // æ­¥éª¤1ï¼šåˆ†ç¦»é¦–å±/éé¦–å±å›¾ç‰‡\n                const [viewportImgs, otherImgs] = CONFIG.imageLoad.viewportFirst\n                    ? this.splitViewportImages(imgs)\n                    : [[], imgs];\n\n                // æ­¥éª¤2ï¼šå…ˆåŠ è½½é¦–å±å›¾ç‰‡\n                await this.loadImageBatch(viewportImgs);\n                // æ­¥éª¤3ï¼šåˆ†æ‰¹åŠ è½½å‰©ä½™å›¾ç‰‡\n                for (let i = 0; i < otherImgs.length; i += CONFIG.imageLoad.batchSize) {\n                    const batch = otherImgs.slice(i, i + CONFIG.imageLoad.batchSize);\n                    await this.loadImageBatch(batch);\n                }\n            },\n\n            // åŠ è½½å•æ‰¹å›¾ç‰‡\n            async loadImageBatch(imgs) {\n                if (!imgs.length) return Promise.resolve();\n                const promises = imgs.map(img => this.loadImage(img));\n                await Promise.allSettled(promises); // ä¸é˜»å¡æ‰¹æ¬¡åŠ è½½\n            },\n\n            // åˆ†ç¦»è§†å£å†…/å¤–å›¾ç‰‡\n            splitViewportImages(imgs) {\n                const viewportImgs = [];\n                const otherImgs = [];\n                const viewportHeight = window.innerHeight;\n\n                imgs.forEach(img => {\n                    const rect = img.getBoundingClientRect();\n                    // å›¾ç‰‡è¿›å…¥/å³å°†è¿›å…¥è§†å£ï¼ˆæå‰200pxï¼‰\n                    const isInViewport = rect.top < viewportHeight + 200 && rect.bottom > -200;\n                    isInViewport ? viewportImgs.push(img) : otherImgs.push(img);\n                });\n                return [viewportImgs, otherImgs];\n            },\n\n            // åŠ è½½å•å¼ å›¾ç‰‡\n            loadImage(img) {\n                // è·³è¿‡å·²åŠ è½½/å¤±è´¥/åŠ è½½ä¸­çš„å›¾ç‰‡\n                if (img.hasAttribute('loaded') || img.classList.contains('error')) return Promise.resolve();\n                if (img.hasAttribute('loading')) return new Promise(resolve => {\n                    // ç›‘å¬åŠ è½½å®Œæˆï¼ˆé¿å…é‡å¤è¯·æ±‚ï¼‰\n                    const onLoad = () => { resolve(); img.removeEventListener('load', onLoad); };\n                    const onError = () => { resolve(); img.removeEventListener('error', onError); };\n                    img.addEventListener('load', onLoad);\n                    img.addEventListener('error', onError);\n                });\n\n                // æ ‡è®°åŠ è½½ä¸­\n                img.setAttribute('loading', '');\n                // åˆå§‹åŒ–é‡è¯•æ¬¡æ•°ï¼ˆå­˜åœ¨åˆ™å¤ç”¨ï¼‰\n                const attempt = parseInt(img.dataset.retryAttempt || 1);\n                // åˆ›å»ºä¸­æ–­æ§åˆ¶å™¨\n                const controller = new AbortController();\n                const signal = controller.signal;\n                imageAbortControllers.set(img, controller);\n\n                return new Promise((resolve) => {\n                    const src = CONFIG.imageLoad.cache && attempt === 1\n                        ? img.dataset.src\n                        : img.dataset.src + '?t=' + Date.now();\n\n                    const tempImg = new Image();\n                    tempImg.signal = signal;\n\n                    tempImg.onload = () => {\n                        this.handleSuccess(img, tempImg);\n                        imageAbortControllers.delete(img);\n                        resolve();\n                    };\n\n                    tempImg.onerror = () => {\n                        this.handleError(img, attempt).then(resolve).catch(resolve);\n                        imageAbortControllers.delete(img);\n                    };\n\n                    // ç›‘å¬ä¸­æ–­ä¿¡å·\n                    signal.addEventListener('abort', () => {\n                        img.removeAttribute('loading');\n                        resolve();\n                    });\n\n                    tempImg.src = src;\n                });\n            },\n\n            // åŠ è½½æˆåŠŸå¤„ç†\n            handleSuccess(img, tempImg) {\n                img.removeAttribute('loading');\n                // æå‰è®¡ç®—å®½é«˜æ¯”ï¼Œå‡å°‘å¸ƒå±€æŠ–åŠ¨\n                const aspectRatio = tempImg.naturalWidth / tempImg.naturalHeight;\n                if (aspectRatio > 1) {\n                    img.parentElement.style.setProperty('--aspect-ratio', '4 / 3');\n                }\n                // å¼‚æ­¥è®¾ç½®srcï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹\n                requestAnimationFrame(() => {\n                    img.src = tempImg.src;\n                    img.setAttribute('loaded', '');\n                    viewerManager.update();\n                });\n            },\n\n            // åŠ è½½å¤±è´¥å¤„ç†ï¼ˆä¸¥è°¨çš„é‡è¯•é€»è¾‘ï¼‰\n            async handleError(img, attempt) {\n                img.removeAttribute('loading');\n                // è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°\n                if (attempt >= CONFIG.retry.maxAttempts) {\n                    img.classList.add('error');\n                    img.alt = 'å›¾ç‰‡åŠ è½½å¤±è´¥';\n                    viewerManager.update();\n                    return;\n                }\n\n                // è®°å½•å½“å‰é‡è¯•æ¬¡æ•°\n                img.dataset.retryAttempt = attempt + 1;\n                // è®¡ç®—é€€é¿æ—¶é—´ï¼ˆæŒ‡æ•°é€€é¿ï¼‰\n                const delay = CONFIG.retry.initialDelay * Math.pow(CONFIG.retry.backoff, attempt - 1);\n\n                // å»¶è¿Ÿé‡è¯•\n                await new Promise(resolve => setTimeout(resolve, delay));\n                // é‡è¯•åŠ è½½\n                await this.loadImage(img);\n            }\n        };\n\n        // --- 3. é¡µé¢çº§æ— é™æ»šåŠ¨è§¦å‘ ---\n        function initPagination() {\n            const sentinel = document.createElement('div');\n            sentinel.id = CONFIG.selectors.sentinel.slice(1);\n            document.querySelector(CONFIG.selectors.gallery).after(sentinel);\n\n            pageObserver = new IntersectionObserver(entries => {\n                if (entries[0].isIntersecting && !isLoading && !loadFailed) {\n                    loadMorePages();\n                }\n            }, CONFIG.observer);\n            pageObserver.observe(sentinel);\n        }\n\n        // --- 4. é¡µé¢æ•°æ®è¯·æ±‚ ---\n        async function fetchPage(p) {\n            try {\n                const url = CONFIG.pageUrlTemplate.replace(\"{baseUrl}\", CONFIG.baseUrl).replace(\"{page}\", p);\n                const response = await fetch(url);\n                if (!response.ok) throw new Error('HTTP error! status: ' + response.status);\n                const text = await response.text();\n                const doc = new DOMParser().parseFromString(text, 'text/html');\n                return Array.from(doc.querySelectorAll(CONFIG.imageSelector)).map(img => img.src);\n            } catch (error) {\n                throw new Error('ç¬¬' + p + 'é¡µåŠ è½½å¤±è´¥: ' + error.message);\n            }\n        }\n\n        // --- 5. å›¾ç‰‡DOMæ’å…¥ + ä¼˜åŒ–åŠ è½½ ---\n        function appendImagesToDOM(imageUrls) {\n            const fragment = document.createDocumentFragment();\n            const gallery = document.querySelector(CONFIG.selectors.gallery);\n            const newImgs = [];\n\n            imageUrls.forEach(src => {\n                const li = document.createElement('li');\n                const img = document.createElement('img');\n                img.dataset.src = src;\n                img.alt = 'å†™çœŸ';\n                li.appendChild(img);\n                fragment.appendChild(li);\n                newImgs.push(img);\n            });\n\n            gallery.appendChild(fragment);\n            // å¯åŠ¨é¡ºåºåŠ è½½\n            imageLoader.loadImagesInOrder(newImgs);\n            viewerManager.update();\n        }\n\n        // --- 6. åŠ è½½ä¸‹ä¸€é¡µæ•°æ® ---\n        async function loadMorePages() {\n            if (page > CONFIG.totalPage) {\n                document.querySelector(CONFIG.selectors.loadStatus).textContent = CONFIG.endText;\n                pageObserver?.disconnect();\n                return;\n            }\n\n            isLoading = true;\n            document.querySelector(CONFIG.selectors.loadStatus).textContent = 'åŠ è½½ä¸­...';\n\n            try {\n                const promises = [];\n                for (let i = 0; i < CONFIG.loadPages && (page + i) <= CONFIG.totalPage; i++) {\n                    promises.push(fetchPage(page + i));\n                }\n\n                const results = await Promise.all(promises);\n                const allNewImages = results.flat();\n\n                if (allNewImages.length > 0) {\n                    appendImagesToDOM(allNewImages);\n                    page += CONFIG.loadPages;\n                } else {\n                    throw new Error(\"æœªè·å–åˆ°æ–°å›¾ç‰‡\");\n                }\n\n                if (page > CONFIG.totalPage) {\n                    document.querySelector(CONFIG.selectors.loadStatus).textContent = CONFIG.endText;\n                    pageObserver?.disconnect();\n                }\n\n            } catch (error) {\n                console.error(error);\n                document.querySelector(CONFIG.selectors.loadStatus).innerHTML = '< span style = \"color:red\" >' + CONFIG.errorText + '</span >';\n                loadFailed = true;\n            } finally {\n                isLoading = false;\n            }\n        }\n\n        // --- åˆå§‹åŒ– ---\n        document.addEventListener('DOMContentLoaded', () => {\n            viewerManager.init();\n            initPagination();\n            loadMorePages();\n        });\n\n        window.addEventListener('resize', () => viewerManager.update());\n        window.addEventListener('beforeunload', () => viewerManager.destroy());\n    </script>\n</body>\n</html>`;\n}",
    "lastUpdateTime": 1768393316670,
    "loadWithBaseUrl": true,
    "preload": false,
    "ruleArticles": "class.img@li||id.list@ul@li",
    "ruleContent": "@js:\nlet params = {\n    totalPage: String(java.getString(\"@@class.pagelist@tag.a.-2@text\")),//æ€»é¡µæ•°\n    baseUrl: `${baseUrl.replace('.html', '_')}`,//æå–é“¾æ¥\n    pageUrlTemplate: \"{baseUrl}{page}.html\", //ä¸‹ä¸€é¡µURLæ¨¡æ¿\n    imageSelector: \"#picg img\", //cssé€‰æ‹©å™¨\n}\ngetHtml(params)",
    "ruleImage": "a.0@img@src##$##,{\n  \"headers\": {\"Referer\": \"http://www.mttaotu.com/\"}\n}",
    "ruleLink": "a.0@href",
    "ruleNextPage": "page",
    "ruleTitle": "a.0@title",
    "showWebLog": false,
    "singleUrl": false,
    "sortUrl": "é¦–é¡µ::/##$##,{\"webView\": true}\n\næœç´¢::/s.asp?keyword={{java.encodeURI(source.getVariable(),'gb2312')}}##$##,{\"webView\": true}\n\t\næ€§æ„Ÿ::/model/list/1_{{page}}.html##$##,{\"webView\": true}\n\næ—¥éŸ©::/model/list/2_{{page}}.html##$##,{\"webView\": true}\n\nå†…è¡£::/model/list/9_{{page}}.html##$##,{\"webView\": true}\n\nèŒå¦¹::/model/list/11_{{page}}.html##$##,{\"webView\": true}\n\nç²¾å“::/model/list/18_{{page}}.html##$##,{\"webView\": true}\n\né«˜æ¸…::/model/list/24_{{page}}.html##$##,{\"webView\": true}\n\næ— åœ£å…‰::/model/list/25_{{page}}.html##$##,{\"webView\": true}\n",
    "sourceGroup": "å›¾ç‰‡",
    "sourceIcon": "http://pic.mttaotu.com/photo/jpgfile/2023610/202361001549774.jpg##$##,{\n  \"headers\":{\"Referer\": \"http://www.mttaotu.com/\"}\n}",
    "sourceName": "æ¨¡ç‰¹å¥—å›¾",
    "sourceUrl": "http://www.mttaotu.com",
    "type": 0
  },
  {
    "articleStyle": 2,
    "cacheFirst": false,
    "customOrder": 89,
    "enableJs": true,
    "enabled": true,
    "enabledCookieJar": true,
    "header": "{\"Referer\":\"https://www.xiurenbox.com/\"}",
    "jsLib": "function getHtml(params) {\n    return `<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n    <title>å›¾ç‰‡</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.css\">\n    <style>\n        :root {\n            --item-width: 97vw;\n            --aspect-ratio: 65/100;\n        }\n\n        body {\n            margin: 0;\n            padding: 20px 0;\n            background-color: floralwhite;\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n            min-height: 100vh;\n        }\n\n        .gallery {\n            list-style: none;\n            padding: 0;\n            margin: 0 auto;\n            width: calc(var(--item-width) - 30px);\n            max-width: 400px;\n        }\n\n            .gallery li {\n                width: 100%;\n                margin-bottom: 15px;\n                background: floralwhite;\n                border-radius: 8px;\n                overflow: hidden;\n                position: relative;\n                height: 0;\n                padding-top: calc(100% / (var(--aspect-ratio, 3/4)));\n                box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n            }\n\n            .gallery img {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                object-fit: cover;\n                opacity: 0;\n                transition: opacity 0.4s ease-out;\n            }\n\n                .gallery img[loaded] {\n                    opacity: 1;\n                }\n\n                .gallery img.error {\n                    filter: grayscale(1);\n                    background: repeating-linear-gradient(45deg, #f1f3f5, #f1f3f5 10px, #e9ecef 10px, #e9ecef 20px);\n                    color: #ff6b6b;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    font-size: 14px;\n                }\n\n        #load-status {\n            text-align: center;\n            padding: 15px;\n            color: #666;\n        }\n    </style>\n</head>\n<body>\n    <ul class=\"gallery\"></ul>\n    <div id=\"load-status\"></div>\n\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.js\"></script>\n    <script>\n        const CONFIG = {\n            totalPage: ${params.totalPage},\n            baseUrl: \"${params.baseUrl}\",\n            pageUrlTemplate: \"${params.pageUrlTemplate}\",\n            imageSelector: \"${params.imageSelector}\",\n            errorText: \"åŠ è½½å¤±è´¥\",\n            endText: \"å·²åŠ è½½å…¨éƒ¨å†…å®¹\",\n            loadPages: 2,\n            retry: { maxAttempts: 3, initialDelay: 1000, backoff: 2 },\n            viewer: { toolbar: { zoomIn: 1, zoomOut: 1, oneToOne: 1, reset: 1 }, transition: false, navbar: false, title: false },\n            selectors: { gallery: '.gallery', loadStatus: '#load-status', sentinel: '#load-sentinel' },\n            observer: { rootMargin: '800px', threshold: 0.01 },\n            imageLoad: {\n                batchSize: 3, // æ¯æ‰¹åŠ è½½3å¼ \n                viewportFirst: true, // é¦–å±å›¾ç‰‡ä¼˜å…ˆåŠ è½½\n                cache: true // å¯ç”¨å›¾ç‰‡ç¼“å­˜\n            }\n        };\n\n        let page = 1;\n        let isLoading = false;\n        let loadFailed = false;\n        let pageObserver = null;\n        const imageAbortControllers = new Map();\n\n        // --- 1. Viewer.js ç®¡ç† ---\n        const viewerManager = {\n            instance: null,\n            updateTimer: null,\n            init() {\n                if (this.instance) return;\n                this.instance = new Viewer(document.querySelector(CONFIG.selectors.gallery), {\n                    ...CONFIG.viewer,\n                    url: 'data-src'\n                });\n            },\n            // é˜²æŠ–æ›´æ–°Viewerï¼Œå‡å°‘é‡ç»˜\n            update() {\n                clearTimeout(this.updateTimer);\n                this.updateTimer = setTimeout(() => {\n                    this.instance?.update();\n                }, 100);\n            },\n            destroy() {\n                clearTimeout(this.updateTimer);\n                this.instance?.destroy();\n                // ä¸­æ–­æ‰€æœ‰æœªå®Œæˆçš„å›¾ç‰‡è¯·æ±‚\n                imageAbortControllers.forEach(controller => controller.abort());\n                imageAbortControllers.clear();\n            }\n        };\n\n        // --- 2. å›¾ç‰‡åŠ è½½é€»è¾‘ ---\n        const imageLoader = {\n            // å¼‚æ­¥ä¸²è¡Œåˆ†æ‰¹åŠ è½½å›¾ç‰‡\n            async loadImagesInOrder(imgs) {\n                if (!imgs.length) return;\n\n                // æ­¥éª¤1ï¼šåˆ†ç¦»é¦–å±/éé¦–å±å›¾ç‰‡\n                const [viewportImgs, otherImgs] = CONFIG.imageLoad.viewportFirst\n                    ? this.splitViewportImages(imgs)\n                    : [[], imgs];\n\n                // æ­¥éª¤2ï¼šå…ˆåŠ è½½é¦–å±å›¾ç‰‡\n                await this.loadImageBatch(viewportImgs);\n                // æ­¥éª¤3ï¼šåˆ†æ‰¹åŠ è½½å‰©ä½™å›¾ç‰‡\n                for (let i = 0; i < otherImgs.length; i += CONFIG.imageLoad.batchSize) {\n                    const batch = otherImgs.slice(i, i + CONFIG.imageLoad.batchSize);\n                    await this.loadImageBatch(batch);\n                }\n            },\n\n            // åŠ è½½å•æ‰¹å›¾ç‰‡\n            async loadImageBatch(imgs) {\n                if (!imgs.length) return Promise.resolve();\n                const promises = imgs.map(img => this.loadImage(img));\n                await Promise.allSettled(promises); // ä¸é˜»å¡æ‰¹æ¬¡åŠ è½½\n            },\n\n            // åˆ†ç¦»è§†å£å†…/å¤–å›¾ç‰‡\n            splitViewportImages(imgs) {\n                const viewportImgs = [];\n                const otherImgs = [];\n                const viewportHeight = window.innerHeight;\n\n                imgs.forEach(img => {\n                    const rect = img.getBoundingClientRect();\n                    // å›¾ç‰‡è¿›å…¥/å³å°†è¿›å…¥è§†å£ï¼ˆæå‰200pxï¼‰\n                    const isInViewport = rect.top < viewportHeight + 200 && rect.bottom > -200;\n                    isInViewport ? viewportImgs.push(img) : otherImgs.push(img);\n                });\n                return [viewportImgs, otherImgs];\n            },\n\n            // åŠ è½½å•å¼ å›¾ç‰‡\n            loadImage(img) {\n                // è·³è¿‡å·²åŠ è½½/å¤±è´¥/åŠ è½½ä¸­çš„å›¾ç‰‡\n                if (img.hasAttribute('loaded') || img.classList.contains('error')) return Promise.resolve();\n                if (img.hasAttribute('loading')) return new Promise(resolve => {\n                    // ç›‘å¬åŠ è½½å®Œæˆï¼ˆé¿å…é‡å¤è¯·æ±‚ï¼‰\n                    const onLoad = () => { resolve(); img.removeEventListener('load', onLoad); };\n                    const onError = () => { resolve(); img.removeEventListener('error', onError); };\n                    img.addEventListener('load', onLoad);\n                    img.addEventListener('error', onError);\n                });\n\n                // æ ‡è®°åŠ è½½ä¸­\n                img.setAttribute('loading', '');\n                // åˆå§‹åŒ–é‡è¯•æ¬¡æ•°ï¼ˆå­˜åœ¨åˆ™å¤ç”¨ï¼‰\n                const attempt = parseInt(img.dataset.retryAttempt || 1);\n                // åˆ›å»ºä¸­æ–­æ§åˆ¶å™¨\n                const controller = new AbortController();\n                const signal = controller.signal;\n                imageAbortControllers.set(img, controller);\n\n                return new Promise((resolve) => {\n                    const src = CONFIG.imageLoad.cache && attempt === 1\n                        ? img.dataset.src\n                        : img.dataset.src + '?t=' + Date.now();\n\n                    const tempImg = new Image();\n                    tempImg.signal = signal;\n\n                    tempImg.onload = () => {\n                        this.handleSuccess(img, tempImg);\n                        imageAbortControllers.delete(img);\n                        resolve();\n                    };\n\n                    tempImg.onerror = () => {\n                        this.handleError(img, attempt).then(resolve).catch(resolve);\n                        imageAbortControllers.delete(img);\n                    };\n\n                    // ç›‘å¬ä¸­æ–­ä¿¡å·\n                    signal.addEventListener('abort', () => {\n                        img.removeAttribute('loading');\n                        resolve();\n                    });\n\n                    tempImg.src = src;\n                });\n            },\n\n            // åŠ è½½æˆåŠŸå¤„ç†\n            handleSuccess(img, tempImg) {\n                img.removeAttribute('loading');\n                // æå‰è®¡ç®—å®½é«˜æ¯”ï¼Œå‡å°‘å¸ƒå±€æŠ–åŠ¨\n                const aspectRatio = tempImg.naturalWidth / tempImg.naturalHeight;\n                if (aspectRatio > 1) {\n                    img.parentElement.style.setProperty('--aspect-ratio', '4 / 3');\n                }\n                // å¼‚æ­¥è®¾ç½®srcï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹\n                requestAnimationFrame(() => {\n                    img.src = tempImg.src;\n                    img.setAttribute('loaded', '');\n                    viewerManager.update();\n                });\n            },\n\n            // åŠ è½½å¤±è´¥å¤„ç†ï¼ˆä¸¥è°¨çš„é‡è¯•é€»è¾‘ï¼‰\n            async handleError(img, attempt) {\n                img.removeAttribute('loading');\n                // è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°\n                if (attempt >= CONFIG.retry.maxAttempts) {\n                    img.classList.add('error');\n                    img.alt = 'å›¾ç‰‡åŠ è½½å¤±è´¥';\n                    viewerManager.update();\n                    return;\n                }\n\n                // è®°å½•å½“å‰é‡è¯•æ¬¡æ•°\n                img.dataset.retryAttempt = attempt + 1;\n                // è®¡ç®—é€€é¿æ—¶é—´ï¼ˆæŒ‡æ•°é€€é¿ï¼‰\n                const delay = CONFIG.retry.initialDelay * Math.pow(CONFIG.retry.backoff, attempt - 1);\n\n                // å»¶è¿Ÿé‡è¯•\n                await new Promise(resolve => setTimeout(resolve, delay));\n                // é‡è¯•åŠ è½½\n                await this.loadImage(img);\n            }\n        };\n\n        // --- 3. é¡µé¢çº§æ— é™æ»šåŠ¨è§¦å‘ ---\n        function initPagination() {\n            const sentinel = document.createElement('div');\n            sentinel.id = CONFIG.selectors.sentinel.slice(1);\n            document.querySelector(CONFIG.selectors.gallery).after(sentinel);\n\n            pageObserver = new IntersectionObserver(entries => {\n                if (entries[0].isIntersecting && !isLoading && !loadFailed) {\n                    loadMorePages();\n                }\n            }, CONFIG.observer);\n            pageObserver.observe(sentinel);\n        }\n\n        // --- 4. é¡µé¢æ•°æ®è¯·æ±‚ ---\n        async function fetchPage(p) {\n            try {\n                const url = CONFIG.pageUrlTemplate.replace(\"{baseUrl}\", CONFIG.baseUrl).replace(\"{page}\", p);\n                const response = await fetch(url);\n                if (!response.ok) throw new Error('HTTP error! status: ' + response.status);\n                const text = await response.text();\n                const doc = new DOMParser().parseFromString(text, 'text/html');\n                return Array.from(doc.querySelectorAll(CONFIG.imageSelector)).map(img => img.src);\n            } catch (error) {\n                throw new Error('ç¬¬' + p + 'é¡µåŠ è½½å¤±è´¥: ' + error.message);\n            }\n        }\n\n        // --- 5. å›¾ç‰‡DOMæ’å…¥ + ä¼˜åŒ–åŠ è½½ ---\n        function appendImagesToDOM(imageUrls) {\n            const fragment = document.createDocumentFragment();\n            const gallery = document.querySelector(CONFIG.selectors.gallery);\n            const newImgs = [];\n\n            imageUrls.forEach(src => {\n                const li = document.createElement('li');\n                const img = document.createElement('img');\n                img.dataset.src = src;\n                img.alt = 'å†™çœŸ';\n                li.appendChild(img);\n                fragment.appendChild(li);\n                newImgs.push(img);\n            });\n\n            gallery.appendChild(fragment);\n            // å¯åŠ¨é¡ºåºåŠ è½½\n            imageLoader.loadImagesInOrder(newImgs);\n            viewerManager.update();\n        }\n\n        // --- 6. åŠ è½½ä¸‹ä¸€é¡µæ•°æ® ---\n        async function loadMorePages() {\n            if (page > CONFIG.totalPage) {\n                document.querySelector(CONFIG.selectors.loadStatus).textContent = CONFIG.endText;\n                pageObserver?.disconnect();\n                return;\n            }\n\n            isLoading = true;\n            document.querySelector(CONFIG.selectors.loadStatus).textContent = 'åŠ è½½ä¸­...';\n\n            try {\n                const promises = [];\n                for (let i = 0; i < CONFIG.loadPages && (page + i) <= CONFIG.totalPage; i++) {\n                    promises.push(fetchPage(page + i));\n                }\n\n                const results = await Promise.all(promises);\n                const allNewImages = results.flat();\n\n                if (allNewImages.length > 0) {\n                    appendImagesToDOM(allNewImages);\n                    page += CONFIG.loadPages;\n                } else {\n                    throw new Error(\"æœªè·å–åˆ°æ–°å›¾ç‰‡\");\n                }\n\n                if (page > CONFIG.totalPage) {\n                    document.querySelector(CONFIG.selectors.loadStatus).textContent = CONFIG.endText;\n                    pageObserver?.disconnect();\n                }\n\n            } catch (error) {\n                console.error(error);\n                document.querySelector(CONFIG.selectors.loadStatus).innerHTML = '< span style = \"color:red\" >' + CONFIG.errorText + '</span >';\n                loadFailed = true;\n            } finally {\n                isLoading = false;\n            }\n        }\n\n        // --- åˆå§‹åŒ– ---\n        document.addEventListener('DOMContentLoaded', () => {\n            viewerManager.init();\n            initPagination();\n            loadMorePages();\n        });\n\n        window.addEventListener('resize', () => viewerManager.update());\n        window.addEventListener('beforeunload', () => viewerManager.destroy());\n    </script>\n</body>\n</html>`;\n}",
    "lastUpdateTime": 1768394303356,
    "loadWithBaseUrl": true,
    "preload": false,
    "ruleArticles": "#posts article",
    "ruleContent": "@js:\nlet params = {\n    totalPage: String(java.getString(\"@@class.content-main@class.page-indicator@ownText\")).replace(\"/\",\"\"),//æ€»é¡µæ•°\n    baseUrl: `${baseUrl}`,//æå–é“¾æ¥\n    pageUrlTemplate: \"{baseUrl}{page}\", //ä¸‹ä¸€é¡µURLæ¨¡æ¿\n    imageSelector: \"figure noscript img\", //cssé€‰æ‹©å™¨\n}\ngetHtml(params)",
    "ruleImage": "img@data-lazy-src##$##,{\n  \"headers\":{\"Referer\": \"https://www.xiurenbox.com/\"}\n}",
    "ruleLink": "a.0@href",
    "ruleNextPage": ".next-page@a@href",
    "rulePubDate": "span.-1@text",
    "ruleTitle": "h2@text",
    "showWebLog": false,
    "singleUrl": false,
    "sortUrl": "ç§€äººç½‘ğŸ”¥::https://www.xiurenbox.com/xiuren/\næ˜Ÿé¢œç¤¾â¤ï¸::https://www.xiurenbox.com/xingyan/\nå°¤èœœèŸâœ¨::https://www.xiurenbox.com/youmi/\nèŠ±æ¼¾ğŸ‰::https://www.xiurenbox.com/huayang/ç¾åª›é¦†::https://www.xiurenbox.com/mygir/\nç”»è¯­ç•Œ::https://www.xiurenbox.com/xiaoyu/\nçˆ±èœœç¤¾::https://www.xiurenbox.com/imiss/\nå¾¡å¥³éƒ::https://www.xiurenbox.com/dkgirl/\nå°¤ç‰©é¦†::https://www.xiurenbox.com/youwu/\nå—²å›¡å›¡::https://www.xiurenbox.com/feilin/\nå…”å‡ ç›Ÿ::https://www.xiurenbox.com/bololi/\nä¼˜æ˜Ÿé¦†::https://www.xiurenbox.com/uxing/\næ˜Ÿä¹å›­::https://www.xiurenbox.com/leyuan/\næ¨¡èŒƒå­¦é™¢::https://www.xiurenbox.com/mfstar/\nçŒ«èŒæ¦œ::https://www.xiurenbox.com/micat/\nç³–æœç”»æŠ¥::https://www.xiurenbox.com/candy/\nèŠ±ã®é¢œ::https://www.xiurenbox.com/huayan/\nèœœæ¡ƒç¤¾::https://www.xiurenbox.com/miitao/\nè–„è·å¶::https://www.xiurenbox.com/mintye/\né¡½å‘³ç”Ÿæ´»::https://www.xiurenbox.com/taste/\nå½±ç§èŸ::https://www.xiurenbox.com/wings/\né­…å¦ç¤¾::https://www.xiurenbox.com/mistar/\næ¨¡ç‰¹è”ç›Ÿ::https://www.xiurenbox.com/mtmeng/",
    "sourceGroup": "å›¾ç‰‡",
    "sourceIcon": "https://www.xiurenbox.com/wp-content/uploads/2025/09/17969.webp",
    "sourceName": "ç¾å¥³å›¾å†Œ",
    "sourceUrl": "https://www.xiurenbox.com",
    "type": 0
  },
  {
    "articleStyle": 2,
    "cacheFirst": false,
    "customOrder": 91,
    "enableJs": true,
    "enabled": true,
    "enabledCookieJar": true,
    "header": "{\"User-Agent\":\"Mozilla/5.0 (Linux; Android 16; 2211133C Build/BP2A.250605.031.A3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.7499.34 Mobile Safari/537.36\"}",
    "jsLib": "function getImgTag(link) {\n    if (typeof link !== 'string' || link.trim() === '') {\n        return '';\n    }\n\n    const list = link.split('\\n')\n        .map(item => item.trim())\n        .filter(item => item !== '');\n\n    if (list.length === 0) {\n        return '';\n    }\n\n    const imgTags = list.reduce((acc, url) => {\n        if (url.startsWith('http://') || url.startsWith('https://')) {\n            acc.push(`<li><img data-src=\"${url}\" alt=\"å›¾ç‰‡\"></li>`);\n        }\n        return acc;\n    }, []);\n\n    return '\\n' + imgTags.join('\\n') + '\\n';\n}\n\nfunction getHtml(imgTag) {\n    return `<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n    <title>å›¾ç‰‡</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.css\">\n    <style>\n        :root {\n            --item-width: 97vw;\n            --aspect-ratio: 65/100;\n        }\n\n        body {\n            margin: 0;\n            padding: 20px 0;\n            background-color: floralwhite;\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n            min-height: 100vh;\n        }\n\n        .gallery {\n            list-style: none;\n            padding: 0;\n            margin: 0 auto;\n            width: calc(var(--item-width) - 30px);\n            max-width: 400px;\n        }\n\n            .gallery li {\n                width: 100%;\n                margin-bottom: 15px;\n                background: floralwhite;\n                border-radius: 8px;\n                overflow: hidden;\n                position: relative;\n                height: 0;\n                padding-top: calc(100% / (var(--aspect-ratio, 3/4)));\n                box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n                /* é¢„åŠ è½½å ä½ï¼Œå‡å°‘é—ªçƒ */\n                background: #f8f9fa;\n            }\n\n                .gallery li.error {\n                    background: repeating-linear-gradient( 45deg, #f1f3f5, #f1f3f5 10px, #e9ecef 10px, #e9ecef 20px );\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    color: #ff6b6b;\n                    font-size: 14px;\n                }\n\n                    .gallery li.error::after {\n                        content: \"åŠ è½½å¤±è´¥\";\n                    }\n\n            .gallery img {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                object-fit: cover;\n                opacity: 0;\n                transition: opacity 0.4s ease-out;\n                /* æå‡å›¾ç‰‡æ¸²æŸ“æ€§èƒ½ */\n                will-change: opacity;\n            }\n\n                .gallery img[loaded] {\n                    opacity: 1;\n                }\n    </style>\n</head>\n<body>\n    <ul class=\"gallery\">\n        ${imgTag}\n    </ul>\n\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.js\"></script>\n    <script>\n        const CONFIG = {\n            retry: {\n                maxAttempts: 3,\n                initialDelay: 1000,\n                backoff: 2\n            },\n            viewer: {\n                toolbar: {\n                    zoomIn: 1,\n                    zoomOut: 1,\n                    oneToOne: 1,\n                    reset: 1\n                },\n                transition: false,\n                navbar: false,\n                title: false\n            },\n            // å¹¶å‘æ§åˆ¶é…ç½®\n            load: {\n                concurrency: 3, // åŒæ—¶åŠ è½½çš„å›¾ç‰‡æ•°é‡\n                batchDelay: 300 // æ‰¹æ¬¡åŠ è½½å»¶è¿Ÿï¼ˆmsï¼‰\n            }\n        };\n\n        // Viewerå®ä¾‹ç®¡ç† - ä¼˜åŒ–æ›´æ–°é¢‘ç‡\n        const viewerManager = {\n            instance: null,\n            updateTimer: null,\n            init() {\n                if (this.instance) return;\n                this.instance = new Viewer(document.querySelector('.gallery'), {\n                    ...CONFIG.viewer,\n                    url: 'data-src'\n                });\n            },\n            // é˜²æŠ–æ›´æ–°ï¼Œå‡å°‘DOMæ“ä½œ\n            update() {\n                if (this.updateTimer) clearTimeout(this.updateTimer);\n                this.updateTimer = setTimeout(() => {\n                    this.instance?.update();\n                    this.updateTimer = null;\n                }, 100);\n            },\n            destroy() {\n                if (this.instance) {\n                    try {\n                        this.instance.destroy();\n                        document.querySelectorAll('.viewer-container').forEach(container => container.remove());\n                    } catch (e) {\n                        console.error('Vieweré”€æ¯å¤±è´¥:', e);\n                    }\n                    this.instance = null;\n                }\n            }\n        };\n\n        // å›¾ç‰‡åŠ è½½æ§åˆ¶ - æ ¸å¿ƒä¼˜åŒ–\n        const imageLoader = {\n            loadingCount: 0, // å½“å‰åŠ è½½ä¸­çš„å›¾ç‰‡æ•°\n            imageQueue: [],  // å¾…åŠ è½½å›¾ç‰‡é˜Ÿåˆ—\n\n            // åˆå§‹åŒ–åŠ è½½é˜Ÿåˆ—\n            initQueue() {\n                this.imageQueue = Array.from(document.querySelectorAll('.gallery img'));\n                // å¯åŠ¨å¹¶å‘åŠ è½½\n                this.loadNextBatch();\n            },\n\n            // åŠ è½½ä¸‹ä¸€æ‰¹å›¾ç‰‡\n            loadNextBatch() {\n                // è¿˜æœ‰å¾…åŠ è½½å›¾ç‰‡ && å½“å‰åŠ è½½æ•° < æœ€å¤§å¹¶å‘æ•°\n                while (this.imageQueue.length > 0 && this.loadingCount < CONFIG.load.concurrency) {\n                    const img = this.imageQueue.shift();\n                    this.loadImage(img);\n                }\n            },\n\n            // å•å¼ å›¾ç‰‡åŠ è½½é€»è¾‘\n            loadImage(img, attempt = 1) {\n                // é˜²æ­¢é‡å¤åŠ è½½\n                if (img.hasAttribute('loading') || img.src || img.parentElement.classList.contains('error')) {\n                    this.loadingCount--;\n                    this.loadNextBatch();\n                    return;\n                }\n\n                img.setAttribute('loading', '');\n                this.loadingCount++;\n\n                // ç§»é™¤æ—¶é—´æˆ³ï¼Œåˆ©ç”¨æµè§ˆå™¨ç¼“å­˜\n                const src = img.dataset.src;\n                const tempImg = new Image();\n\n                tempImg.onload = () => {\n                    // æå‰è®¡ç®—å®½é«˜æ¯”ï¼Œå‡å°‘å¸ƒå±€é—ªçƒ\n                    const aspectRatio = tempImg.naturalWidth / tempImg.naturalHeight;\n                    if (aspectRatio > 1) {\n                        img.parentElement.style.setProperty('--aspect-ratio', 4/3);\n                    }\n\n                    img.src = src;\n                    img.setAttribute('loaded', '');\n                    img.removeAttribute('loading');\n\n                    this.loadingCount--;\n                    this.scheduleViewerUpdate();\n\n                    // å»¶è¿ŸåŠ è½½ä¸‹ä¸€æ‰¹ï¼Œé¿å…ç¬é—´è¯·æ±‚\n                    setTimeout(() => {\n                        this.loadNextBatch();\n                    }, CONFIG.load.batchDelay);\n                };\n\n                tempImg.onerror = () => {\n                    img.removeAttribute('loading');\n                    this.handleError(img, attempt);\n                };\n\n                // ä¼˜åŒ–ï¼šæ·»åŠ è¶…æ—¶å¤„ç†\n                tempImg.timeoutId = setTimeout(() => {\n                    tempImg.onerror();\n                }, 10000); // 10ç§’è¶…æ—¶\n\n                tempImg.src = src;\n            },\n\n            // é”™è¯¯å¤„ç†ï¼ˆä¿®å¤é‡è¯•è®¡æ•°ï¼‰\n            handleError(img, attempt) {\n                this.loadingCount--;\n\n                // é‡è¯•æ¬¡æ•°æœªè¾¾ä¸Šé™\n                if (attempt < CONFIG.retry.maxAttempts) {\n                    const delay = CONFIG.retry.initialDelay * Math.pow(CONFIG.retry.backoff, attempt - 1);\n                    setTimeout(() => {\n                        // é‡æ–°åŠ å…¥é˜Ÿåˆ—æœ«å°¾\n                        this.imageQueue.push(img);\n                        this.loadNextBatch();\n                    }, delay);\n                } else {\n                    // é‡è¯•å¤±è´¥\n                    img.parentElement.classList.add('error');\n                    img.alt = 'å›¾ç‰‡åŠ è½½å¤±è´¥';\n                    this.scheduleViewerUpdate();\n                    // åŠ è½½ä¸‹ä¸€å¼ \n                    this.loadNextBatch();\n                }\n            },\n\n            scheduleViewerUpdate() {\n                viewerManager.update();\n            }\n        };\n\n        // é¡µé¢åˆå§‹åŒ–\n        document.addEventListener('DOMContentLoaded', () => {\n            viewerManager.init();\n            imageLoader.initQueue();\n        });\n\n        // çª—å£å˜åŒ–æ—¶é˜²æŠ–æ›´æ–°\n        window.addEventListener('resize', () => {\n            viewerManager.update();\n        });\n\n        // é¡µé¢å¸è½½æ—¶é”€æ¯\n        window.addEventListener('beforeunload', () => {\n            viewerManager.destroy();\n        });\n    </script>\n</body>\n</html>`;\n}",
    "lastUpdateTime": 1768394872199,
    "loadWithBaseUrl": true,
    "preload": false,
    "ruleArticles": "li@figure",
    "ruleContent": "class.list-gallery@li@img@src\n<js>\nresult = getHtml(getImgTag(result));\n</js>",
    "ruleImage": "img@src",
    "ruleLink": "a.0@href",
    "ruleNextPage": "page",
    "ruleTitle": "a.0@title",
    "showWebLog": false,
    "singleUrl": false,
    "sortUrl": "Trend::/gridapi/?content=updates&sort=trending&mpage={{page}}\nNewest::/gridapi/?content=updates&sort=newest&mpage={{page}}\n\nPopular::/gridapi/?content=updates&sort=popular&mpage={{page}}\n\nPopular-month::/gridapi/?content=updates&sort=popular-month&mpage={{page}}\n\nPopular-week::/gridapi/?content=updates&sort=popular-week&mpage={{page}}",
    "sourceGroup": "å›¾ç‰‡",
    "sourceIcon": "https://cdn.metarthunter.com/content/250974/96367_masonry_400.jpg",
    "sourceName": "MetartHunter",
    "sourceUrl": "https://www.metarthunter.com",
    "type": 0
  },
  {
    "articleStyle": 3,
    "cacheFirst": false,
    "customOrder": 92,
    "enableJs": true,
    "enabled": true,
    "enabledCookieJar": true,
    "header": "{\"User-Agent\":\"Mozilla/5.0 (Linux; Android 16; 2211133C Build/BP2A.250605.031.A3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.7499.34 Mobile Safari/537.36\"}",
    "jsLib": "function getHtml(params) {\n    return `<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\">\n    <title>å›¾ç‰‡</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.css\">\n    <style>\n        :root {\n            --item-width: 97vw;\n            --aspect-ratio: 65/100;\n        }\n\n        body {\n            margin: 0;\n            padding: 20px 0;\n            background-color: floralwhite;\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n            min-height: 100vh;\n        }\n\n        .gallery {\n            list-style: none;\n            padding: 0;\n            margin: 0 auto;\n            width: calc(var(--item-width) - 30px);\n            max-width: 400px;\n        }\n\n            .gallery li {\n                width: 100%;\n                margin-bottom: 15px;\n                background: floralwhite;\n                border-radius: 8px;\n                overflow: hidden;\n                position: relative;\n                height: 0;\n                padding-top: calc(100% / (var(--aspect-ratio, 3/4)));\n                box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n            }\n\n            .gallery img {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                object-fit: cover;\n                opacity: 0;\n                transition: opacity 0.4s ease-out;\n            }\n\n                .gallery img[loaded] {\n                    opacity: 1;\n                }\n\n                .gallery img.error {\n                    filter: grayscale(1);\n                    background: repeating-linear-gradient(45deg, #f1f3f5, #f1f3f5 10px, #e9ecef 10px, #e9ecef 20px);\n                    color: #ff6b6b;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    font-size: 14px;\n                }\n\n        #load-status {\n            text-align: center;\n            padding: 15px;\n            color: #666;\n        }\n    </style>\n</head>\n<body>\n    <ul class=\"gallery\"></ul>\n    <div id=\"load-status\"></div>\n\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.0/viewer.min.js\"></script>\n    <script>\n        const CONFIG = {\n            totalPage: ${params.totalPage},\n            baseUrl: \"${params.baseUrl}\",\n            pageUrlTemplate: \"${params.pageUrlTemplate}\",\n            imageSelector: \"${params.imageSelector}\",\n            errorText: \"åŠ è½½å¤±è´¥\",\n            endText: \"å·²åŠ è½½å…¨éƒ¨å†…å®¹\",\n            loadPages: 2,\n            retry: { maxAttempts: 3, initialDelay: 1000, backoff: 2 },\n            viewer: { toolbar: { zoomIn: 1, zoomOut: 1, oneToOne: 1, reset: 1 }, transition: false, navbar: false, title: false },\n            selectors: { gallery: '.gallery', loadStatus: '#load-status', sentinel: '#load-sentinel' },\n            observer: { rootMargin: '800px', threshold: 0.01 },\n            imageLoad: {\n                batchSize: 3, // æ¯æ‰¹åŠ è½½3å¼ \n                viewportFirst: true, // é¦–å±å›¾ç‰‡ä¼˜å…ˆåŠ è½½\n                cache: true // å¯ç”¨å›¾ç‰‡ç¼“å­˜\n            }\n        };\n\n        let page = 1;\n        let isLoading = false;\n        let loadFailed = false;\n        let pageObserver = null;\n        const imageAbortControllers = new Map();\n\n        // --- 1. Viewer.js ç®¡ç† ---\n        const viewerManager = {\n            instance: null,\n            updateTimer: null,\n            init() {\n                if (this.instance) return;\n                this.instance = new Viewer(document.querySelector(CONFIG.selectors.gallery), {\n                    ...CONFIG.viewer,\n                    url: 'data-src'\n                });\n            },\n            // é˜²æŠ–æ›´æ–°Viewerï¼Œå‡å°‘é‡ç»˜\n            update() {\n                clearTimeout(this.updateTimer);\n                this.updateTimer = setTimeout(() => {\n                    this.instance?.update();\n                }, 100);\n            },\n            destroy() {\n                clearTimeout(this.updateTimer);\n                this.instance?.destroy();\n                // ä¸­æ–­æ‰€æœ‰æœªå®Œæˆçš„å›¾ç‰‡è¯·æ±‚\n                imageAbortControllers.forEach(controller => controller.abort());\n                imageAbortControllers.clear();\n            }\n        };\n\n        // --- 2. å›¾ç‰‡åŠ è½½é€»è¾‘ ---\n        const imageLoader = {\n            // å¼‚æ­¥ä¸²è¡Œåˆ†æ‰¹åŠ è½½å›¾ç‰‡\n            async loadImagesInOrder(imgs) {\n                if (!imgs.length) return;\n\n                // æ­¥éª¤1ï¼šåˆ†ç¦»é¦–å±/éé¦–å±å›¾ç‰‡\n                const [viewportImgs, otherImgs] = CONFIG.imageLoad.viewportFirst\n                    ? this.splitViewportImages(imgs)\n                    : [[], imgs];\n\n                // æ­¥éª¤2ï¼šå…ˆåŠ è½½é¦–å±å›¾ç‰‡\n                await this.loadImageBatch(viewportImgs);\n                // æ­¥éª¤3ï¼šåˆ†æ‰¹åŠ è½½å‰©ä½™å›¾ç‰‡\n                for (let i = 0; i < otherImgs.length; i += CONFIG.imageLoad.batchSize) {\n                    const batch = otherImgs.slice(i, i + CONFIG.imageLoad.batchSize);\n                    await this.loadImageBatch(batch);\n                }\n            },\n\n            // åŠ è½½å•æ‰¹å›¾ç‰‡\n            async loadImageBatch(imgs) {\n                if (!imgs.length) return Promise.resolve();\n                const promises = imgs.map(img => this.loadImage(img));\n                await Promise.allSettled(promises); // ä¸é˜»å¡æ‰¹æ¬¡åŠ è½½\n            },\n\n            // åˆ†ç¦»è§†å£å†…/å¤–å›¾ç‰‡\n            splitViewportImages(imgs) {\n                const viewportImgs = [];\n                const otherImgs = [];\n                const viewportHeight = window.innerHeight;\n\n                imgs.forEach(img => {\n                    const rect = img.getBoundingClientRect();\n                    // å›¾ç‰‡è¿›å…¥/å³å°†è¿›å…¥è§†å£ï¼ˆæå‰200pxï¼‰\n                    const isInViewport = rect.top < viewportHeight + 200 && rect.bottom > -200;\n                    isInViewport ? viewportImgs.push(img) : otherImgs.push(img);\n                });\n                return [viewportImgs, otherImgs];\n            },\n\n            // åŠ è½½å•å¼ å›¾ç‰‡\n            loadImage(img) {\n                // è·³è¿‡å·²åŠ è½½/å¤±è´¥/åŠ è½½ä¸­çš„å›¾ç‰‡\n                if (img.hasAttribute('loaded') || img.classList.contains('error')) return Promise.resolve();\n                if (img.hasAttribute('loading')) return new Promise(resolve => {\n                    // ç›‘å¬åŠ è½½å®Œæˆï¼ˆé¿å…é‡å¤è¯·æ±‚ï¼‰\n                    const onLoad = () => { resolve(); img.removeEventListener('load', onLoad); };\n                    const onError = () => { resolve(); img.removeEventListener('error', onError); };\n                    img.addEventListener('load', onLoad);\n                    img.addEventListener('error', onError);\n                });\n\n                // æ ‡è®°åŠ è½½ä¸­\n                img.setAttribute('loading', '');\n                // åˆå§‹åŒ–é‡è¯•æ¬¡æ•°ï¼ˆå­˜åœ¨åˆ™å¤ç”¨ï¼‰\n                const attempt = parseInt(img.dataset.retryAttempt || 1);\n                // åˆ›å»ºä¸­æ–­æ§åˆ¶å™¨\n                const controller = new AbortController();\n                const signal = controller.signal;\n                imageAbortControllers.set(img, controller);\n\n                return new Promise((resolve) => {\n                    const src = CONFIG.imageLoad.cache && attempt === 1\n                        ? img.dataset.src\n                        : img.dataset.src + '?t=' + Date.now();\n\n                    const tempImg = new Image();\n                    tempImg.signal = signal;\n\n                    tempImg.onload = () => {\n                        this.handleSuccess(img, tempImg);\n                        imageAbortControllers.delete(img);\n                        resolve();\n                    };\n\n                    tempImg.onerror = () => {\n                        this.handleError(img, attempt).then(resolve).catch(resolve);\n                        imageAbortControllers.delete(img);\n                    };\n\n                    // ç›‘å¬ä¸­æ–­ä¿¡å·\n                    signal.addEventListener('abort', () => {\n                        img.removeAttribute('loading');\n                        resolve();\n                    });\n\n                    tempImg.src = src;\n                });\n            },\n\n            // åŠ è½½æˆåŠŸå¤„ç†\n            handleSuccess(img, tempImg) {\n                img.removeAttribute('loading');\n                // æå‰è®¡ç®—å®½é«˜æ¯”ï¼Œå‡å°‘å¸ƒå±€æŠ–åŠ¨\n                const aspectRatio = tempImg.naturalWidth / tempImg.naturalHeight;\n                if (aspectRatio > 1) {\n                    img.parentElement.style.setProperty('--aspect-ratio', '4 / 3');\n                }\n                // å¼‚æ­¥è®¾ç½®srcï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹\n                requestAnimationFrame(() => {\n                    img.src = tempImg.src;\n                    img.setAttribute('loaded', '');\n                    viewerManager.update();\n                });\n            },\n\n            // åŠ è½½å¤±è´¥å¤„ç†ï¼ˆä¸¥è°¨çš„é‡è¯•é€»è¾‘ï¼‰\n            async handleError(img, attempt) {\n                img.removeAttribute('loading');\n                // è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°\n                if (attempt >= CONFIG.retry.maxAttempts) {\n                    img.classList.add('error');\n                    img.alt = 'å›¾ç‰‡åŠ è½½å¤±è´¥';\n                    viewerManager.update();\n                    return;\n                }\n\n                // è®°å½•å½“å‰é‡è¯•æ¬¡æ•°\n                img.dataset.retryAttempt = attempt + 1;\n                // è®¡ç®—é€€é¿æ—¶é—´ï¼ˆæŒ‡æ•°é€€é¿ï¼‰\n                const delay = CONFIG.retry.initialDelay * Math.pow(CONFIG.retry.backoff, attempt - 1);\n\n                // å»¶è¿Ÿé‡è¯•\n                await new Promise(resolve => setTimeout(resolve, delay));\n                // é‡è¯•åŠ è½½\n                await this.loadImage(img);\n            }\n        };\n\n        // --- 3. é¡µé¢çº§æ— é™æ»šåŠ¨è§¦å‘ ---\n        function initPagination() {\n            const sentinel = document.createElement('div');\n            sentinel.id = CONFIG.selectors.sentinel.slice(1);\n            document.querySelector(CONFIG.selectors.gallery).after(sentinel);\n\n            pageObserver = new IntersectionObserver(entries => {\n                if (entries[0].isIntersecting && !isLoading && !loadFailed) {\n                    loadMorePages();\n                }\n            }, CONFIG.observer);\n            pageObserver.observe(sentinel);\n        }\n\n        // --- 4. é¡µé¢æ•°æ®è¯·æ±‚ ---\n        async function fetchPage(p) {\n            try {\n                const url = CONFIG.pageUrlTemplate.replace(\"{baseUrl}\", CONFIG.baseUrl).replace(\"{page}\", p);\n                const response = await fetch(url);\n                if (!response.ok) throw new Error('HTTP error! status: ' + response.status);\n                const text = await response.text();\n                const doc = new DOMParser().parseFromString(text, 'text/html');\n                return Array.from(doc.querySelectorAll(CONFIG.imageSelector)).map(img => img.src);\n            } catch (error) {\n                throw new Error('ç¬¬' + p + 'é¡µåŠ è½½å¤±è´¥: ' + error.message);\n            }\n        }\n\n        // --- 5. å›¾ç‰‡DOMæ’å…¥ + ä¼˜åŒ–åŠ è½½ ---\n        function appendImagesToDOM(imageUrls) {\n            const fragment = document.createDocumentFragment();\n            const gallery = document.querySelector(CONFIG.selectors.gallery);\n            const newImgs = [];\n\n            imageUrls.forEach(src => {\n                const li = document.createElement('li');\n                const img = document.createElement('img');\n                img.dataset.src = src;\n                img.alt = 'å†™çœŸ';\n                li.appendChild(img);\n                fragment.appendChild(li);\n                newImgs.push(img);\n            });\n\n            gallery.appendChild(fragment);\n            // å¯åŠ¨é¡ºåºåŠ è½½\n            imageLoader.loadImagesInOrder(newImgs);\n            viewerManager.update();\n        }\n\n        // --- 6. åŠ è½½ä¸‹ä¸€é¡µæ•°æ® ---\n        async function loadMorePages() {\n            if (page > CONFIG.totalPage) {\n                document.querySelector(CONFIG.selectors.loadStatus).textContent = CONFIG.endText;\n                pageObserver?.disconnect();\n                return;\n            }\n\n            isLoading = true;\n            document.querySelector(CONFIG.selectors.loadStatus).textContent = 'åŠ è½½ä¸­...';\n\n            try {\n                const promises = [];\n                for (let i = 0; i < CONFIG.loadPages && (page + i) <= CONFIG.totalPage; i++) {\n                    promises.push(fetchPage(page + i));\n                }\n\n                const results = await Promise.all(promises);\n                const allNewImages = results.flat();\n\n                if (allNewImages.length > 0) {\n                    appendImagesToDOM(allNewImages);\n                    page += CONFIG.loadPages;\n                } else {\n                    throw new Error(\"æœªè·å–åˆ°æ–°å›¾ç‰‡\");\n                }\n\n                if (page > CONFIG.totalPage) {\n                    document.querySelector(CONFIG.selectors.loadStatus).textContent = CONFIG.endText;\n                    pageObserver?.disconnect();\n                }\n\n            } catch (error) {\n                console.error(error);\n                document.querySelector(CONFIG.selectors.loadStatus).innerHTML = '< span style = \"color:red\" >' + CONFIG.errorText + '</span >';\n                loadFailed = true;\n            } finally {\n                isLoading = false;\n            }\n        }\n\n        // --- åˆå§‹åŒ– ---\n        document.addEventListener('DOMContentLoaded', () => {\n            viewerManager.init();\n            initPagination();\n            loadMorePages();\n        });\n\n        window.addEventListener('resize', () => viewerManager.update());\n        window.addEventListener('beforeunload', () => viewerManager.destroy());\n    </script>\n</body>\n</html>`;\n}",
    "lastUpdateTime": 1768395393649,
    "loadWithBaseUrl": true,
    "preload": false,
    "ruleArticles": "class.main-body@class.blog@class.items-row||.footer .popular-item",
    "ruleContent": "@js:\nlet params = {\n    totalPage: String(java.getString(\"@@class.pagination.0@class.pagination-list@a.-1@text\")),//æ€»é¡µæ•°\n    baseUrl: `${baseUrl}`,//æå–é“¾æ¥\n    pageUrlTemplate: \"{baseUrl}?page={page}\", //ä¸‹ä¸€é¡µURLæ¨¡æ¿\n    imageSelector: \".article-fulltext img\", //cssé€‰æ‹©å™¨\n}\ngetHtml(params)",
    "ruleImage": "a.0@img@src##$##,{\n\t\"headers\":{\"referer\": \"https://buondua.com/\"}\n}",
    "ruleLink": "a.0@href",
    "ruleNextPage": "class.pagination@class.pagination-next.0@href",
    "ruleTitle": "h2@text||a.0@title",
    "showWebLog": false,
    "singleUrl": false,
    "sortUrl": "BuonDua::/\nHot::https:/hot\nYouMayLike::/collection\nJP::/tag/jp-11853\nXiuRen::/tag/xiuren-7417\nCosplay::/tag/cosplay-10688\nHuaYang::/tag/huayang-7444",
    "sourceGroup": "å›¾ç‰‡",
    "sourceIcon": "https://i2.buondua.us/2025/51269/Cosplayer-every-year-Nnian-cowgirl-MissKON.com-059.jpeg?cd980ec81cc3309244b62246e1784b86##$##,{\n\t\"headers\":{\"referer\": \"https://buondua.com/\"}\n}",
    "sourceName": "BuonDua",
    "sourceUrl": "https://buondua.com",
    "type": 0
  }
]